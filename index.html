<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hoorian Cosmetics & Jewelry - POS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <style>
    :root {
      --bg-dark: #111111;
      --bg-card: #1b1b1b;
      --accent-pink: #ff4f9a;
      --accent-pink-soft: #ff9ac5;
      --text-main: #ffffff;
      --text-muted: #bbbbbb;
      --danger: #ff4f4f;
      --success: #4caf50;
      --border-color: #333333;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--bg-dark);
      color: var(--text-main);
    }
    header {
      background: linear-gradient(90deg, #000000, #2b0b1a);
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border-color);
    }
    .logo { display: flex; align-items: center; gap: 10px; }
    .logo-circle {
      width: 40px; height: 40px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffffff, #ff4f9a, #000000);
      display: flex; align-items: center; justify-content: center;
      font-weight: bold; color: #000; font-size: 18px;
    }
    .logo-text { display: flex; flex-direction: column; }
    .logo-text-main { font-size: 18px; font-weight: bold; letter-spacing: 0.5px; }
    .logo-text-sub { font-size: 11px; color: var(--accent-pink-soft); text-transform: uppercase; letter-spacing: 1px; }
    .header-right { font-size: 12px; color: var(--text-muted); text-align: right; }
    .header-right span { display: block; }
    .lang-toggle { margin-top: 4px; }
    .lang-toggle button {
      padding: 3px 8px; border-radius: 999px;
      border: 1px solid var(--accent-pink-soft);
      background: transparent; color: var(--accent-pink-soft);
      font-size: 11px; cursor: pointer;
    }
    .lang-toggle button.active {
      background: var(--accent-pink-soft);
      color: #000;
    }
    .container { display: flex; min-height: calc(100vh - 60px); }
    .sidebar {
      width: 230px; background: #000000;
      border-right: 1px solid var(--border-color);
      padding: 10px;
    }
    .sidebar h3 {
      margin-top: 0; font-size: 14px;
      text-transform: uppercase; color: var(--accent-pink-soft);
      letter-spacing: 1px;
    }
    .nav-btn {
      width: 100%; padding: 10px; margin-bottom: 6px;
      border-radius: 4px; border: 1px solid var(--border-color);
      background: #111111; color: var(--text-main);
      text-align: left; cursor: pointer; font-size: 13px;
      display: flex; justify-content: space-between; align-items: center;
    }
    .nav-btn.active {
      background: var(--accent-pink);
      border-color: var(--accent-pink);
      color: #000; font-weight: bold;
    }
    .nav-btn span.badge {
      background: #222; padding: 2px 6px;
      border-radius: 10px; font-size: 11px;
      color: var(--accent-pink-soft);
    }
    .main { flex: 1; padding: 15px; overflow-y: auto; }
    .card {
      background: var(--bg-card);
      border-radius: 6px;
      padding: 12px 14px;
      margin-bottom: 12px;
      border: 1px solid var(--border-color);
    }
    .card h2 { margin: 0 0 10px 0; font-size: 16px; color: var(--accent-pink-soft); }
    .card h3 { margin: 0 0 8px 0; font-size: 14px; color: var(--accent-pink-soft); }
    label {
      display: block; margin-top: 6px;
      font-size: 12px; color: var(--text-muted);
    }
    input, select, textarea {
      width: 100%; padding: 7px; margin-top: 3px;
      border-radius: 4px; border: 1px solid var(--border-color);
      background: #111111; color: var(--text-main); font-size: 13px;
    }
    textarea { resize: vertical; min-height: 50px; }
    .row { display: flex; flex-wrap: wrap; gap: 10px; }
    .col-50 { flex: 1 1 48%; }
    .col-33 { flex: 1 1 32%; }
    .btn {
      padding: 8px 12px; border-radius: 4px;
      border: none; cursor: pointer;
      font-size: 13px; font-weight: bold;
      margin-top: 8px;
    }
    .btn-primary { background: var(--accent-pink); color: #000; }
    .btn-secondary { background: #333333; color: var(--text-main); }
    .btn-danger { background: var(--danger); color: #fff; }
    .btn-small { padding: 4px 8px; font-size: 11px; }
    table {
      width: 100%; border-collapse: collapse;
      font-size: 12px; margin-top: 8px;
    }
    th, td {
      border: 1px solid var(--border-color);
      padding: 5px; text-align: left;
    }
    th { background: #151515; color: var(--accent-pink-soft); }
    .tag {
      display: inline-block; padding: 2px 6px;
      border-radius: 10px; font-size: 10px;
      margin-right: 4px;
    }
    .tag-low { background: #3b0000; color: var(--danger); }
    .tag-hot { background: #002b12; color: var(--success); }
    .muted { color: var(--text-muted); font-size: 11px; }
    .stat-grid { display: flex; flex-wrap: wrap; gap: 10px; }
    .stat-card {
      flex: 1 1 24%; background: #111111;
      border-radius: 6px; padding: 8px;
      border: 1px solid var(--border-color);
      font-size: 12px;
    }
    .stat-label { color: var(--text-muted); font-size: 11px; }
    .stat-value { font-size: 16px; font-weight: bold; margin-top: 4px; }
    .stat-positive { color: var(--success); }
    .stat-negative { color: var(--danger); }
    .pill {
      display: inline-block; padding: 2px 8px;
      border-radius: 999px; font-size: 11px;
      border: 1px solid var(--border-color);
      margin-right: 4px; margin-bottom: 4px;
    }
    .pill-active {
      background: var(--accent-pink);
      color: #000; border-color: var(--accent-pink);
    }
    .login-overlay {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.9);
      display: flex; align-items: center; justify-content: center;
      z-index: 999;
    }
    .login-box {
      background: #111111; padding: 20px;
      border-radius: 8px; width: 320px;
      border: 1px solid var(--accent-pink-soft);
      text-align: center;
    }
    .login-box h2 { margin-top: 0; color: var(--accent-pink-soft); }
    .login-box p { font-size: 12px; color: var(--text-muted); }
    @media (max-width: 800px) {
      .container { flex-direction: column; }
      .sidebar { width: 100%; display: flex; overflow-x: auto; }
      .sidebar h3 { display: none; }
      .nav-btn { flex: 1 1 auto; white-space: nowrap; }
    }
  </style>
</head>
<body>
  <div class="login-overlay" id="loginOverlay">
    <div class="login-box">
      <h2 data-key="login_title"></h2>
      <p data-key="login_subtitle"></p>
      <label data-key="login_username_label"></label>
      <input type="text" id="loginUser" placeholder="admin" />
      <label data-key="login_password_label"></label>
      <input type="password" id="loginPass" placeholder="admin" />
      <button class="btn btn-primary" style="width:100%;margin-top:12px;" id="loginBtn" data-key="login_button"></button>
      <p class="muted" style="margin-top:10px;" data-key="login_hint"></p>
    </div>
  </div>

  <header>
    <div class="logo">
      <div class="logo-circle">H</div>
      <div class="logo-text">
        <span class="logo-text-main" data-key="app_title"></span>
        <span class="logo-text-sub" data-key="app_subtitle"></span>
      </div>
    </div>
    <div class="header-right">
      <span id="headerUser"></span>
      <span id="headerDate"></span>
      <div class="lang-toggle">
        <button id="btnLangEN">EN</button>
        <button id="btnLangUR">UR</button>
      </div>
    </div>
  </header>

  <div class="container">
    <aside class="sidebar">
      <h3 data-key="menu_title"></h3>
      <button class="nav-btn active" data-view="dashboardView">
        <span data-key="menu_dashboard"></span> <span class="badge" data-key="menu_dashboard_badge"></span>
      </button>
      <button class="nav-btn" data-view="inventoryView">
        <span data-key="menu_inventory"></span> <span class="badge" data-key="menu_inventory_badge"></span>
      </button>
      <button class="nav-btn" data-view="salesView">
        <span data-key="menu_sales"></span> <span class="badge" data-key="menu_sales_badge"></span>
      </button>
      <button class="nav-btn" data-view="expensesView">
        <span data-key="menu_expenses"></span> <span class="badge" data-key="menu_expenses_badge"></span>
      </button>
      <button class="nav-btn" data-view="invoicesView">
        <span data-key="menu_invoices"></span> <span class="badge" data-key="menu_invoices_badge"></span>
      </button>
      <button class="nav-btn" data-view="settingsView">
        <span data-key="menu_settings"></span> <span class="badge" data-key="menu_settings_badge"></span>
      </button>
    </aside>

    <main class="main">
      <section id="dashboardView" class="card">
        <h2 data-key="dashboard_title"></h2>
        <div class="row">
          <div class="col-50">
            <div class="stat-grid">
              <div class="stat-card">
                <div class="stat-label" data-key="stat_today_sales_label"></div>
                <div class="stat-value" id="statTodaySales">0.00</div>
              </div>
              <div class="stat-card">
                <div class="stat-label" data-key="stat_week_sales_label"></div>
                <div class="stat-value" id="statWeekSales">0.00</div>
              </div>
              <div class="stat-card">
                <div class="stat-label" data-key="stat_month_sales_label"></div>
                <div class="stat-value" id="statMonthSales">0.00</div>
              </div>
              <div class="stat-card">
                <div class="stat-label" data-key="stat_profit_label"></div>
                <div class="stat-value" id="statProfit">0.00</div>
              </div>
            </div>
          </div>
          <div class="col-50">
            <h3 data-key="dashboard_quick_title"></h3>
            <p class="muted" data-key="dashboard_quick_text"></p>
            <div>
              <span class="pill" id="countProducts"></span>
              <span class="pill" id="countLowStock"></span>
              <span class="pill" id="countHotSale"></span>
              <span class="pill" id="countInvoices"></span>
            </div>
            <p class="muted" style="margin-top:10px;">
              üíÑ Lipsticks ‚Ä¢ üíç Jewelry ‚Ä¢ ü©≤ Undergarments ‚Äî sab ka stock, sales aur profit yahan se control karo.
            </p>
          </div>
        </div>

        <h3 style="margin-top:15px;" data-key="dashboard_stock_title"></h3>
        <table id="dashboardStockTable">
          <thead>
            <tr>
              <th data-key="tbl_code"></th>
              <th data-key="tbl_name"></th>
              <th data-key="tbl_category"></th>
              <th data-key="tbl_stock"></th>
              <th data-key="tbl_tags"></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <section id="inventoryView" class="card" style="display:none;">
        <h2 data-key="inventory_title"></h2>
        <div class="row">
          <div class="col-50">
            <h3 data-key="inventory_add_title"></h3>
            <label data-key="inventory_code_label"></label>
            <input type="text" id="invCode" />
            <label data-key="inventory_name_label"></label>
            <input type="text" id="invName" />
            <label data-key="inventory_category_label"></label>
            <select id="invCategory">
              <option value="Cosmetics" data-key="cat_cosmetics"></option>
              <option value="Jewelry" data-key="cat_jewelry"></option>
              <option value="Undergarments" data-key="cat_undergarments"></option>
            </select>
            <div class="row">
              <div class="col-50">
                <label data-key="inventory_stock_label"></label>
                <input type="number" id="invStock" min="0" value="0" />
              </div>
              <div class="col-50">
                <label data-key="inventory_lowstock_label"></label>
                <input type="number" id="invLowStock" min="0" value="5" />
              </div>
            </div>
            <div class="row">
              <div class="col-50">
                <label data-key="inventory_cost_label"></label>
                <input type="number" id="invCost" min="0" step="0.01" value="0" />
              </div>
              <div class="col-50">
                <label data-key="inventory_price_label"></label>
                <input type="number" id="invPrice" min="0" step="0.01" value="0" />
              </div>
            </div>
            <label>
              <input type="checkbox" id="invHotSale" />
              <span data-key="inventory_hotsale_label"></span>
            </label>
            <button class="btn btn-primary" id="btnSaveProduct" data-key="btn_save_product"></button>
            <button class="btn btn-secondary btn-small" id="btnClearProduct" data-key="btn_clear"></button>
            <p class="muted" data-key="inventory_tip"></p>
          </div>
          <div class="col-50">
            <h3 data-key="inventory_list_title"></h3>
            <div class="row">
              <div class="col-50">
                <label data-key="inventory_search_label"></label>
                <input type="text" id="invSearch" />
              </div>
              <div class="col-50">
                <label data-key="inventory_filter_label"></label>
                <select id="invFilterCategory">
                  <option value="" data-key="filter_all"></option>
                  <option value="Cosmetics" data-key="cat_cosmetics"></option>
                  <option value="Jewelry" data-key="cat_jewelry"></option>
                  <option value="Undergarments" data-key="cat_undergarments"></option>
                </select>
              </div>
            </div>
            <table id="invTable">
              <thead>
                <tr>
                  <th data-key="tbl_code"></th>
                  <th data-key="tbl_name"></th>
                  <th data-key="tbl_category_short"></th>
                  <th data-key="tbl_stock"></th>
                  <th data-key="tbl_price"></th>
                  <th data-key="tbl_tags"></th>
                  <th data-key="tbl_action"></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="salesView" class="card" style="display:none;">
        <h2 data-key="sales_title"></h2>
        <div class="row">
          <div class="col-50">
            <h3 data-key="sales_add_title"></h3>
            <label data-key="sales_search_label"></label>
            <input type="text" id="posSearch" />
            <table id="posSearchTable">
              <thead>
                <tr>
                  <th data-key="tbl_code"></th>
                  <th data-key="tbl_name"></th>
                  <th data-key="tbl_category_short"></th>
                  <th data-key="tbl_stock"></th>
                  <th data-key="tbl_price"></th>
                  <th data-key="tbl_add"></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="col-50">
            <h3 data-key="sales_cart_title"></h3>
            <table id="cartTable">
              <thead>
                <tr>
                  <th data-key="tbl_item"></th>
                  <th data-key="tbl_qty"></th>
                  <th data-key="tbl_price"></th>
                  <th data-key="tbl_total"></th>
                  <th></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
            <div style="margin-top:8px;">
              <span class="pill" id="cartItemsCount"></span>
              <span class="pill" id="cartTotalAmount"></span>
            </div>
            <label data-key="sales_customer_label"></label>
            <input type="text" id="cartCustomerName" />
            <label data-key="sales_notes_label"></label>
            <textarea id="cartNotes"></textarea>
            <button class="btn btn-primary" id="btnCheckout" data-key="btn_checkout"></button>
            <button class="btn btn-secondary btn-small" id="btnClearCart" data-key="btn_clear_cart"></button>
          </div>
        </div>
      </section>

      <section id="expensesView" class="card" style="display:none;">
        <h2 data-key="expenses_title"></h2>
        <div class="row">
          <div class="col-50">
            <h3 data-key="expenses_add_title"></h3>
            <label data-key="expenses_title_label"></label>
            <input type="text" id="expTitle" />
            <label data-key="expenses_amount_label"></label>
            <input type="number" id="expAmount" min="0" step="0.01" />
            <label data-key="expenses_date_label"></label>
            <input type="date" id="expDate" />
            <label data-key="expenses_note_label"></label>
            <textarea id="expNote"></textarea>
            <button class="btn btn-primary" id="btnAddExpense" data-key="btn_add_expense"></button>
          </div>
          <div class="col-50">
            <h3 data-key="expenses_list_title"></h3>
            <table id="expTable">
              <thead>
                <tr>
                  <th data-key="tbl_date"></th>
                  <th data-key="tbl_title"></th>
                  <th data-key="tbl_amount"></th>
                  <th></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
            <p class="muted">
              <span data-key="expenses_total_label"></span>
              <span id="expTotal">0.00</span> AED
            </p>
          </div>
        </div>
      </section>

      <section id="invoicesView" class="card" style="display:none;">
        <h2 data-key="invoices_title"></h2>
        <div class="row">
          <div class="col-50">
            <h3 data-key="invoices_list_title"></h3>
            <label data-key="invoices_search_label"></label>
            <input type="text" id="invSearchInvoice" />
            <table id="invoiceTable">
              <thead>
                <tr>
                  <th data-key="tbl_invoice_no"></th>
                  <th data-key="tbl_date"></th>
                  <th data-key="tbl_customer"></th>
                  <th data-key="tbl_total"></th>
                  <th data-key="tbl_items"></th>
                  <th data-key="tbl_return"></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          <div class="col-50">
            <h3 data-key="invoices_detail_title"></h3>
            <div id="invoiceDetail" class="muted" data-key="invoices_detail_placeholder"></div>
          </div>
        </div>
      </section>

      <section id="settingsView" class="card" style="display:none;">
        <h2 data-key="settings_title"></h2>
        <h3 data-key="settings_login_title"></h3>
        <label data-key="settings_user_label"></label>
        <input type="text" id="setUser" />
        <label data-key="settings_pass_label"></label>
        <input type="password" id="setPass" />
        <button class="btn btn-primary" id="btnSaveLogin" data-key="btn_save_login"></button>

        <h3 style="margin-top:15px;" data-key="settings_backup_title"></h3>
        <p class="muted" data-key="settings_backup_text"></p>
        <button class="btn btn-secondary btn-small" id="btnExportData" data-key="btn_export"></button>
        <button class="btn btn-danger btn-small" id="btnClearAllData" data-key="btn_clear_all"></button>
        <label data-key="settings_backup_label"></label>
        <textarea id="backupJson"></textarea>
        <button class="btn btn-primary btn-small" id="btnImportData" data-key="btn_import"></button>
      </section>
    </main>
  </div>

  <script>
    const langEN = {
      app_title: "Hoorian Cosmetics & Jewelry",
      app_subtitle: "beauty ‚Ä¢ shine ‚Ä¢ elegance",
      menu_title: "Menu",
      menu_dashboard: "Dashboard",
      menu_dashboard_badge: "Home",
      menu_inventory: "Inventory",
      menu_inventory_badge: "Stock",
      menu_sales: "Sales / POS",
      menu_sales_badge: "Cart",
      menu_expenses: "Expenses",
      menu_expenses_badge: "Cost",
      menu_invoices: "Invoices",
      menu_invoices_badge: "History",
      menu_settings: "Settings",
      menu_settings_badge: "Login",

      login_title: "Hoorian Cosmetics & Jewelry",
      login_subtitle: "Secure login for shop owner / staff.",
      login_username_label: "Username",
      login_password_label: "Password",
      login_button: "Login",
      login_hint: "Default login: admin / admin (local only).",

      dashboard_title: "Sales Dashboard",
      stat_today_sales_label: "Today Sales (AED)",
      stat_week_sales_label: "This Week Sales (AED)",
      stat_month_sales_label: "This Month Sales (AED)",
      stat_profit_label: "Total Profit (Sales - Expenses)",
      dashboard_quick_title: "Quick Overview",
      dashboard_quick_text:
        "‚Ä¢ Low stock items and hot sale items are highlighted below.\n‚Ä¢ All data is stored locally in this browser (localStorage).\n‚Ä¢ Use Inventory tab to add products and manage stock in/out.\n‚Ä¢ Use Sales / POS tab to create cart, checkout and invoices.",
      dashboard_stock_title: "Low Stock & Hot Sale Items",

      inventory_title: "Inventory & Stock",
      inventory_add_title: "Add / Edit Product",
      inventory_code_label: "QR / Code",
      inventory_name_label: "Product Name",
      inventory_category_label: "Category",
      inventory_stock_label: "Stock Quantity",
      inventory_lowstock_label: "Low Stock Level",
      inventory_cost_label: "Cost Price (AED)",
      inventory_price_label: "Selling Price (AED)",
      inventory_hotsale_label: "Mark as Hot Sale Item",
      btn_save_product: "Save / Update Product",
      btn_clear: "Clear",
      inventory_tip:
        "Tip: Use QR / Code field to scan or type product code quickly for search and sales.",
      inventory_list_title: "Inventory List",
      inventory_search_label: "Search by Name / Code",
      inventory_filter_label: "Filter Category",

      cat_cosmetics: "Cosmetics",
      cat_jewelry: "Jewelry",
      cat_undergarments: "Undergarments",
      filter_all: "All",

      sales_title: "Sales / POS",
      sales_add_title: "Add to Cart",
      sales_search_label: "Search Product (Name / Code)",
      sales_cart_title: "Cart",
      sales_customer_label: "Customer Name (optional)",
      sales_notes_label: "Notes (optional)",
      btn_checkout: "Checkout & Create Invoice",
      btn_clear_cart: "Clear Cart",

      expenses_title: "Shop Expenses",
      expenses_add_title: "Add Expense",
      expenses_title_label: "Title",
      expenses_amount_label: "Amount (AED)",
      expenses_date_label: "Date",
      expenses_note_label: "Note",
      btn_add_expense: "Add Expense",
      expenses_list_title: "Expense List",
      expenses_total_label: "Total Expenses:",

      invoices_title: "Invoices & Returns",
      invoices_list_title: "Invoice List",
      invoices_search_label: "Search by Invoice / Customer",
      invoices_detail_title: "Invoice Detail",
      invoices_detail_placeholder: "Select an invoice to view details.",

      settings_title: "Settings & Backup",
      settings_login_title: "Login Settings",
      settings_user_label: "Change Username",
      settings_pass_label: "Change Password",
      btn_save_login: "Save Login",
      settings_backup_title: "Data Backup (Manual)",
      settings_backup_text:
        "You can copy JSON data below and save it somewhere safe. Later you can paste it back to restore.",
      btn_export: "Export Data",
      btn_clear_all: "Clear All Data",
      settings_backup_label: "Backup / Restore JSON",
      btn_import: "Import Data",

      tbl_code: "Code",
      tbl_name: "Name",
      tbl_category: "Category",
      tbl_category_short: "Cat",
      tbl_stock: "Stock",
      tbl_price: "Price",
      tbl_tags: "Tags",
      tbl_action: "Action",
      tbl_add: "Add",
      tbl_item: "Item",
      tbl_qty: "Qty",
      tbl_total: "Total",
      tbl_date: "Date",
      tbl_title: "Title",
      tbl_amount: "Amount",
      tbl_invoice_no: "No.",
      tbl_customer: "Customer",
      tbl_items: "Items",
      tbl_return: "Return"
    };

    const langUR = {
      app_title: "Hoorian Cosmetics & Jewelry",
      app_subtitle: "beauty ‚Ä¢ shine ‚Ä¢ elegance",
      menu_title: "Menu",
      menu_dashboard: "Dashboard",
      menu_dashboard_badge: "Home",
      menu_inventory: "Inventory (Saman)",
      menu_inventory_badge: "Stock",
      menu_sales: "Sales / POS (Sale)",
      menu_sales_badge: "Cart",
      menu_expenses: "Kharchay",
      menu_expenses_badge: "Cost",
      menu_invoices: "Invoices (Bills)",
      menu_invoices_badge: "History",
      menu_settings: "Settings",
      menu_settings_badge: "Login",

      login_title: "Hoorian Cosmetics & Jewelry",
      login_subtitle: "Shop owner / staff ka secure login.",
      login_username_label: "Username (Naam)",
      login_password_label: "Password",
      login_button: "Login",
      login_hint: "Default login: admin / admin (sirf is device par).",

      dashboard_title: "Sales Dashboard (Sales ka Jayeza)",
      stat_today_sales_label: "Aaj ki Sales (AED)",
      stat_week_sales_label: "Is Week ki Sales (AED)",
      stat_month_sales_label: "Is Month ki Sales (AED)",
      stat_profit_label: "Total Profit (Sales - Kharchay)",
      dashboard_quick_title: "Quick Overview (Mukhtasar Jayeza)",
      dashboard_quick_text:
        "‚Ä¢ Low stock aur hot sale items neeche highlight honge.\n‚Ä¢ Saara data sirf is browser mein localStorage mein save hota hai.\n‚Ä¢ Inventory tab se products add karein aur stock manage karein.\n‚Ä¢ Sales / POS tab se cart banayein, checkout karein aur invoice banayein.",
      dashboard_stock_title: "Low Stock & Hot Sale Items",

      inventory_title: "Inventory & Stock (Saman ka Record)",
      inventory_add_title: "Product Add / Edit Karein",
      inventory_code_label: "QR / Code (Number)",
      inventory_name_label: "Product Ka Naam",
      inventory_category_label: "Category (Qism)",
      inventory_stock_label: "Stock Quantity (Kitna Saman)",
      inventory_lowstock_label: "Low Stock Level (Kam Stock Limit)",
      inventory_cost_label: "Cost Price (AED) (Khareed Rate)",
      inventory_price_label: "Selling Price (AED) (Sale Rate)",
      inventory_hotsale_label: "Isay Hot Sale Item mark karein",
      btn_save_product: "Product Save / Update Karein",
      btn_clear: "Clear (Saaf)",
      inventory_tip:
        "Tip: QR / Code field mein code type ya scan karein, search aur sale dono asaan ho jayein ge.",
      inventory_list_title: "Inventory List (Products ki List)",
      inventory_search_label: "Name / Code se Search karein",
      inventory_filter_label: "Category Filter",

      cat_cosmetics: "Cosmetics",
      cat_jewelry: "Jewelry",
      cat_undergarments: "Undergarments",
      filter_all: "Sab",

      sales_title: "Sales / POS (Sale System)",
      sales_add_title: "Cart mein Item Add Karein",
      sales_search_label: "Product Search (Name / Code)",
      sales_cart_title: "Cart (Jo Bechna hai)",
      sales_customer_label: "Customer Name (optional)",
      sales_notes_label: "Note (agar kuch likhna ho)",
      btn_checkout: "Checkout & Invoice Banayein",
      btn_clear_cart: "Cart Clear Karein",

      expenses_title: "Shop Kharchay",
      expenses_add_title: "Naya Kharcha Add Karein",
      expenses_title_label: "Title (Jaise Rent, Salary)",
      expenses_amount_label: "Amount (AED)",
      expenses_date_label: "Date (Tareekh)",
      expenses_note_label: "Note (Zaroori ho to)",
      btn_add_expense: "Kharcha Add Karein",
      expenses_list_title: "Kharchon ki List",
      expenses_total_label: "Total Kharchay:",

      invoices_title: "Invoices & Returns (Bills aur Wapsi)",
      invoices_list_title: "Invoices ki List",
      invoices_search_label: "Invoice / Customer se Search karein",
      invoices_detail_title: "Invoice Detail",
      invoices_detail_placeholder: "Detail dekhne ke liye koi invoice select karein.",

      settings_title: "Settings & Backup",
      settings_login_title: "Login Settings",
      settings_user_label: "Username change karein",
      settings_pass_label: "Password change karein",
      btn_save_login: "Login Save Karein",
      settings_backup_title: "Data Backup (Manual)",
      settings_backup_text:
        "Neeche JSON data copy karke safe jagah par save karein. Baad mein paste karke restore kar sakte hain.",
      btn_export: "Data Export Karein",
      btn_clear_all: "Saara Data Clear Karein",
      settings_backup_label: "Backup / Restore JSON",
      btn_import: "Data Import Karein",

      tbl_code: "Code",
      tbl_name: "Naam",
      tbl_category: "Category",
      tbl_category_short: "Cat",
      tbl_stock: "Stock",
      tbl_price: "Price",
      tbl_tags: "Tags",
      tbl_action: "Action",
      tbl_add: "Add",
      tbl_item: "Item",
      tbl_qty: "Qty",
      tbl_total: "Total",
      tbl_date: "Date",
      tbl_title: "Title",
      tbl_amount: "Amount",
      tbl_invoice_no: "No.",
      tbl_customer: "Customer",
      tbl_items: "Items",
      tbl_return: "Return"
    };

    const KEY_LANG = "hoorian_lang";

    function applyLanguage(lang) {
      const dict = lang === "UR" ? langUR : langEN;
      document.querySelectorAll("[data-key]").forEach(el => {
        const key = el.getAttribute("data-key");
        if (dict[key] !== undefined) {
          el.textContent = dict[key];
        }
      });
      const headerUser = document.getElementById("headerUser");
      if (headerUser && window.currentUser) {
        headerUser.textContent = "User: " + window.currentUser;
      }
      document.getElementById("btnLangEN").classList.toggle("active", lang === "EN");
      document.getElementById("btnLangUR").classList.toggle("active", lang === "UR");
      localStorage.setItem(KEY_LANG, lang);
    }

    const KEY_PRODUCTS = 'hoorian_products';
    const KEY_INVOICES = 'hoorian_invoices';
    const KEY_EXPENSES = 'hoorian_expenses';
    const KEY_LOGIN = 'hoorian_login';

    let products = [];
    let invoices = [];
    let expenses = [];
    let cart = [];
    window.currentUser = null;

    function loadData() {
      products = JSON.parse(localStorage.getItem(KEY_PRODUCTS) || '[]');
      invoices = JSON.parse(localStorage.getItem(KEY_INVOICES) || '[]');
      expenses = JSON.parse(localStorage.getItem(KEY_EXPENSES) || '[]');
      const login = JSON.parse(localStorage.getItem(KEY_LOGIN) || 'null');
      if (!login) {
        localStorage.setItem(
          KEY_LOGIN,
          JSON.stringify({ username: 'admin', password: 'admin' })
        );
      }
      if (products.length === 0) {
        products = [
          { code: 'LIP-RED-01', name: 'Matte Lipstick Red', category: 'Cosmetics', stock: 20, lowStock: 5, cost: 10, price: 25, hotSale: true },
          { code: 'LIP-NUDE-02', name: 'Nude Lipstick', category: 'Cosmetics', stock: 15, lowStock: 5, cost: 9, price: 22, hotSale: true },
          { code: 'JR-RING-01', name: 'Gold Plated Ring', category: 'Jewelry', stock: 10, lowStock: 3, cost: 30, price: 65, hotSale: true },
          { code: 'JR-SET-01', name: 'Bridal Jewelry Set', category: 'Jewelry', stock: 5, lowStock: 2, cost: 80, price: 150, hotSale: false },
          { code: 'UG-BRA-01', name: 'Comfort Bra', category: 'Undergarments', stock: 25, lowStock: 8, cost: 12, price: 30, hotSale: false },
          { code: 'UG-SET-01', name: 'Ladies Undergarment Set', category: 'Undergarments', stock: 18, lowStock: 5, cost: 18, price: 40, hotSale: true }
        ];
        saveProducts();
      }
    }
    function saveProducts() { localStorage.setItem(KEY_PRODUCTS, JSON.stringify(products)); }
    function saveInvoices() { localStorage.setItem(KEY_INVOICES, JSON.stringify(invoices)); }
    function saveExpenses() { localStorage.setItem(KEY_EXPENSES, JSON.stringify(expenses)); }

    function formatDate(d) {
      const dt = new Date(d);
      if (isNaN(dt)) return '';
      return dt.toISOString().slice(0, 10);
    }
    function todayStr() { return new Date().toISOString().slice(0, 10); }
    function sameDay(d1, d2) { return formatDate(d1) === formatDate(d2); }
    function weekOfYear(date) {
      const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
      const dayNum = d.getUTCDay() || 7;
      d.setUTCDate(d.getUTCDate() + 4 - dayNum);
      const yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
      return Math.ceil((((d - yearStart) / 86400000) + 1)/7);
    }
    function monthKey(date) { return date.getFullYear() + '-' + (date.getMonth() + 1); }
    function generateInvoiceNumber() {
      const base = 'INV';
      const num = invoices.length + 1;
      return base + String(num).padStart(4, '0');
    }
    function updateHeaderDate() {
      const el = document.getElementById('headerDate');
      const now = new Date();
      el.textContent = now.toLocaleString();
    }
    setInterval(updateHeaderDate, 60000);

    const loginOverlay = document.getElementById('loginOverlay');
    const loginBtn = document.getElementById('loginBtn');
    loginBtn.addEventListener('click', () => {
      const u = document.getElementById('loginUser').value.trim() || 'admin';
      const p = document.getElementById('loginPass').value.trim() || 'admin';
      const login = JSON.parse(localStorage.getItem(KEY_LOGIN) || 'null');
      if (login && login.username === u && login.password === p) {
        window.currentUser = u;
        loginOverlay.style.display = 'none';
        const lang = localStorage.getItem(KEY_LANG) || 'EN';
        document.getElementById('headerUser').textContent = "User: " + window.currentUser;
        applyLanguage(lang);
      } else {
        alert('Wrong username or password');
      }
    });

    const navButtons = document.querySelectorAll('.nav-btn');
    const views = {
      dashboardView: document.getElementById('dashboardView'),
      inventoryView: document.getElementById('inventoryView'),
      salesView: document.getElementById('salesView'),
      expensesView: document.getElementById('expensesView'),
      invoicesView: document.getElementById('invoicesView'),
      settingsView: document.getElementById('settingsView')
    };
    navButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const view = btn.getAttribute('data-view');
        Object.keys(views).forEach(v => {
          views[v].style.display = v === view ? 'block' : 'none';
        });
        navButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        refreshAll();
      });
    });

    const invCode = document.getElementById('invCode');
    const invName = document.getElementById('invName');
    const invCategory = document.getElementById('invCategory');
    const invStock = document.getElementById('invStock');
    const invLowStock = document.getElementById('invLowStock');
    const invCost = document.getElementById('invCost');
    const invPrice = document.getElementById('invPrice');
    const invHotSale = document.getElementById('invHotSale');
    const invTableBody = document.querySelector('#invTable tbody');
    const invSearch = document.getElementById('invSearch');
    const invFilterCategory = document.getElementById('invFilterCategory');
    let editingProductCode = null;

    function renderInventory() {
      invTableBody.innerHTML = '';
      const search = invSearch.value.trim().toLowerCase();
      const cat = invFilterCategory.value;
      products.forEach(p => {
        if (
          (search &&
            !(
              p.name.toLowerCase().includes(search) ||
              p.code.toLowerCase().includes(search)
            )) ||
          (cat && p.category !== cat)
        ) {
          return;
        }
        const tr = document.createElement('tr');
        const tags = [];
        if (p.stock <= p.lowStock) tags.push('<span class="tag tag-low">Low</span>');
        if (p.hotSale) tags.push('<span class="tag tag-hot">Hot</span>');
        tr.innerHTML = `
          <td>${p.code}</td>
          <td>${p.name}</td>
          <td>${p.category}</td>
          <td>${p.stock}</td>
          <td>${p.price.toFixed(2)}</td>
          <td>${tags.join(' ')}</td>
          <td>
            <button class="btn btn-secondary btn-small" data-code="${p.code}" data-action="edit">Edit</button>
            <button class="btn btn-danger btn-small" data-code="${p.code}" data-action="delete">X</button>
          </td>
        `;
        invTableBody.appendChild(tr);
      });
    }

    document.getElementById('btnSaveProduct').addEventListener('click', () => {
      const code = invCode.value.trim();
      const name = invName.value.trim();
      if (!code || !name) {
        alert('Code and Name required');
        return;
      }
      const category = invCategory.value;
      const stock = parseInt(invStock.value || '0', 10);
      const lowStock = parseInt(invLowStock.value || '0', 10);
      const cost = parseFloat(invCost.value || '0');
      const price = parseFloat(invPrice.value || '0');
      const hotSale = invHotSale.checked;

      const existingIndex = products.findIndex(p => p.code === code);
      if (existingIndex >= 0 && editingProductCode !== code) {
        alert('Code already exists. Use Edit or change code.');
        return;
      }

      const product = { code, name, category, stock, lowStock, cost, price, hotSale };

      if (editingProductCode && editingProductCode === code) {
        const idx = products.findIndex(p => p.code === editingProductCode);
        if (idx >= 0) products[idx] = product;
      } else if (editingProductCode && editingProductCode !== code) {
        const idx = products.findIndex(p => p.code === editingProductCode);
        if (idx >= 0) {
          products.splice(idx, 1, product);
        } else {
          products.push(product);
        }
      } else {
        products.push(product);
      }

      saveProducts();
      clearProductForm();
      renderInventory();
      refreshDashboard();
      alert('Product saved');
    });

    function clearProductForm() {
      editingProductCode = null;
      invCode.value = '';
      invName.value = '';
      invCategory.value = 'Cosmetics';
      invStock.value = '0';
      invLowStock.value = '5';
      invCost.value = '0';
      invPrice.value = '0';
      invHotSale.checked = false;
    }
    document.getElementById('btnClearProduct').addEventListener('click', clearProductForm);

    invTableBody.addEventListener('click', e => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const code = btn.getAttribute('data-code');
      const action = btn.getAttribute('data-action');
      const idx = products.findIndex(p => p.code === code);
      if (idx < 0) return;
      if (action === 'edit') {
        const p = products[idx];
        editingProductCode = p.code;
        invCode.value = p.code;
        invName.value = p.name;
        invCategory.value = p.category;
        invStock.value = p.stock;
        invLowStock.value = p.lowStock;
        invCost.value = p.cost;
        invPrice.value = p.price;
        invHotSale.checked = p.hotSale;
      } else if (action === 'delete') {
        if (confirm('Delete product ' + products[idx].name + '?')) {
          products.splice(idx, 1);
          saveProducts();
          renderInventory();
          refreshDashboard();
        }
      }
    });

    invSearch.addEventListener('input', renderInventory);
    invFilterCategory.addEventListener('change', renderInventory);

    const posSearch = document.getElementById('posSearch');
    const posSearchTableBody = document.querySelector('#posSearchTable tbody');
    const cartTableBody = document.querySelector('#cartTable tbody');
    const cartItemsCount = document.getElementById('cartItemsCount');
    const cartTotalAmount = document.getElementById('cartTotalAmount');
    const cartCustomerName = document.getElementById('cartCustomerName');
    const cartNotes = document.getElementById('cartNotes');

    function renderPosSearch() {
      posSearchTableBody.innerHTML = '';
      const search = posSearch.value.trim().toLowerCase();
      products.forEach(p => {
        if (
          search &&
          !(
            p.name.toLowerCase().includes(search) ||
            p.code.toLowerCase().includes(search)
          )
        ) {
          return;
        }
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${p.code}</td>
          <td>${p.name}</td>
          <td>${p.category}</td>
          <td>${p.stock}</td>
          <td>${p.price.toFixed(2)}</td>
          <td><button class="btn btn-primary btn-small" data-code="${p.code}">Add</button></td>
        `;
        posSearchTableBody.appendChild(tr);
      });
    }
    posSearch.addEventListener('input', renderPosSearch);

    posSearchTableBody.addEventListener('click', e => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const code = btn.getAttribute('data-code');
      const product = products.find(p => p.code === code);
      if (!product) return;
      if (product.stock <= 0) {
        alert('No stock available for this item');
        return;
      }
      const existing = cart.find(c => c.code === code);
      if (existing) {
        if (existing.qty + 1 > product.stock) {
          alert('Not enough stock');
          return;
        }
        existing.qty += 1;
      } else {
        cart.push({ code: product.code, name: product.name, price: product.price, qty: 1 });
      }
      renderCart();
    });

    function renderCart() {
      cartTableBody.innerHTML = '';
      let total = 0;
      cart.forEach((item, index) => {
        const lineTotal = item.qty * item.price;
        total += lineTotal;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${item.name}</td>
          <td>
            <input type="number" min="1" value="${item.qty}" data-index="${index}" class="cart-qty" style="width:60px;" />
          </td>
          <td>${item.price.toFixed(2)}</td>
          <td>${lineTotal.toFixed(2)}</td>
          <td><button class="btn btn-danger btn-small" data-index="${index}">X</button></td>
        `;
        cartTableBody.appendChild(tr);
      });
      cartItemsCount.textContent = 'Items: ' + cart.length;
      cartTotalAmount.textContent = 'Total: ' + total.toFixed(2) + ' AED';
    }

    cartTableBody.addEventListener('input', e => {
      if (e.target.classList.contains('cart-qty')) {
        const index = parseInt(e.target.getAttribute('data-index'), 10);
        const qty = parseInt(e.target.value || '1', 10);
        if (isNaN(qty) || qty <= 0) return;
        const item = cart[index];
        const product = products.find(p => p.code === item.code);
        if (!product) return;
        if (qty > product.stock) {
          alert('Not enough stock');
          e.target.value = product.stock;
          cart[index].qty = product.stock;
        } else {
          cart[index].qty = qty;
        }
        renderCart();
      }
    });

    cartTableBody.addEventListener('click', e => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const index = parseInt(btn.getAttribute('data-index'), 10);
      cart.splice(index, 1);
      renderCart();
    });

    document.getElementById('btnClearCart').addEventListener('click', () => {
      if (confirm('Clear cart?')) {
        cart = [];
        renderCart();
      }
    });

    document.getElementById('btnCheckout').addEventListener('click', () => {
      if (cart.length === 0) {
        alert('Cart is empty');
        return;
      }
      let total = 0;
      cart.forEach(item => { total += item.qty * item.price; });
      const invoiceNo = generateInvoiceNumber();
      const now = new Date();
      const invoice = {
        number: invoiceNo,
        date: now.toISOString(),
        customer: cartCustomerName.value.trim() || 'Walk-in',
        notes: cartNotes.value.trim(),
        items: cart.map(c => ({ ...c })),
        total: total,
        returned: false
      };
      invoices.push(invoice);
      saveInvoices();
      cart.forEach(item => {
        const p = products.find(p => p.code === item.code);
        if (p) {
          p.stock -= item.qty;
          if (p.stock < 0) p.stock = 0;
        }
      });
      saveProducts();
      alert('Invoice created: ' + invoiceNo);
      cart = [];
      cartCustomerName.value = '';
      cartNotes.value = '';
      renderCart();
      renderInventory();
      refreshDashboard();
      renderInvoices();
    });

    const expTitle = document.getElementById('expTitle');
    const expAmount = document.getElementById('expAmount');
    const expDate = document.getElementById('expDate');
    const expNote = document.getElementById('expNote');
    const expTableBody = document.querySelector('#expTable tbody');
    const expTotal = document.getElementById('expTotal');

    document.getElementById('btnAddExpense').addEventListener('click', () => {
      const title = expTitle.value.trim();
      const amount = parseFloat(expAmount.value || '0');
      const date = expDate.value || todayStr();
      if (!title || amount <= 0) {
        alert('Title and amount required');
        return;
      }
      expenses.push({
        id: Date.now(),
        title,
        amount,
        date,
        note: expNote.value.trim()
      });
      saveExpenses();
      expTitle.value = '';
      expAmount.value = '';
      expDate.value = '';
      expNote.value = '';
      renderExpenses();
      refreshDashboard();
    });

    function renderExpenses() {
      expTableBody.innerHTML = '';
      let total = 0;
      expenses.forEach(exp => {
        total += exp.amount;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${formatDate(exp.date)}</td>
          <td>${exp.title}</td>
          <td>${exp.amount.toFixed(2)}</td>
          <td><button class="btn btn-danger btn-small" data-id="${exp.id}">X</button></td>
        `;
        expTableBody.appendChild(tr);
      });
      expTotal.textContent = total.toFixed(2);
    }

    expTableBody.addEventListener('click', e => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const id = parseInt(btn.getAttribute('data-id'), 10);
      const idx = expenses.findIndex(exp => exp.id === id);
      if (idx >= 0 && confirm('Delete this expense?')) {
        expenses.splice(idx, 1);
        saveExpenses();
        renderExpenses();
        refreshDashboard();
      }
    });

    const invoiceTableBody = document.querySelector('#invoiceTable tbody');
    const invoiceDetail = document.getElementById('invoiceDetail');
    const invSearchInvoice = document.getElementById('invSearchInvoice');

    function renderInvoices() {
      invoiceTableBody.innerHTML = '';
      const search = invSearchInvoice.value.trim().toLowerCase();
      invoices.forEach((inv, index) => {
        if (
          search &&
          !(
            inv.number.toLowerCase().includes(search) ||
            inv.customer.toLowerCase().includes(search)
          )
        ) {
          return;
        }
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td><button class="btn btn-secondary btn-small" data-index="${index}" data-action="view">${inv.number}</button></td>
          <td>${formatDate(inv.date)}</td>
          <td>${inv.customer}</td>
          <td>${inv.total.toFixed(2)}</td>
          <td>${inv.items.length}</td>
          <td>
            ${
              inv.returned
                ? '<span class="tag tag-low">Returned</span>'
                : '<button class="btn btn-danger btn-small" data-index="' +
                  index +
                  '" data-action="return">Return</button>'
            }
          </td>
        `;
        invoiceTableBody.appendChild(tr);
      });
      document.getElementById('countInvoices').textContent =
        'Invoices: ' + invoices.length;
    }

    invoiceTableBody.addEventListener('click', e => {
      const btn = e.target.closest('button');
      if (!btn) return;
      const index = parseInt(btn.getAttribute('data-index'), 10);
      const action = btn.getAttribute('data-action');
      const inv = invoices[index];
      if (!inv) return;
      if (action === 'view') {
        showInvoiceDetail(inv);
      } else if (action === 'return') {
        if (inv.returned) {
          alert('Already returned');
          return;
        }
        if (!confirm('Mark this invoice as returned and add items back to stock?')) {
          return;
        }
        inv.returned = true;
        inv.items.forEach(item => {
          const p = products.find(p => p.code === item.code);
          if (p) {
            p.stock += item.qty;
          }
        });
        saveInvoices();
        saveProducts();
        renderInvoices();
        renderInventory();
        refreshDashboard();
      }
    });

    function showInvoiceDetail(inv) {
      let html = '';
      html += '<div><strong>Invoice:</strong> ' + inv.number + '</div>';
      html += '<div><strong>Date:</strong> ' + formatDate(inv.date) + '</div>';
      html += '<div><strong>Customer:</strong> ' + inv.customer + '</div>';
      html += '<div><strong>Total:</strong> ' + inv.total.toFixed(2) + ' AED</div>';
      html += '<div><strong>Returned:</strong> ' + (inv.returned ? 'Yes' : 'No') + '</div>';
      if (inv.notes) {
        html += '<div><strong>Notes:</strong> ' + inv.notes + '</div>';
      }
      html += '<h4 style="margin-top:8px;">Items</h4>';
      html += '<table style="width:100%;font-size:12px;border-collapse:collapse;">';
      html +=
        '<tr><th style="border:1px solid #333;padding:4px;">Item</th><th style="border:1px solid #333;padding:4px;">Qty</th><th style="border:1px solid #333;padding:4px;">Price</th><th style="border:1px solid #333;padding:4px;">Total</th></tr>';
      inv.items.forEach(it => {
        html +=
          '<tr><td style="border:1px solid #333;padding:4px;">' +
          it.name +
          '</td><td style="border:1px solid #333;padding:4px;">' +
          it.qty +
          '</td><td style="border:1px solid #333;padding:4px;">' +
          it.price.toFixed(2) +
          '</td><td style="border:1px solid #333;padding:4px;">' +
          (it.qty * it.price).toFixed(2) +
          '</td></tr>';
      });
      html += '</table>';
      invoiceDetail.innerHTML = html;
    }

    invSearchInvoice.addEventListener('input', renderInvoices);

    const statTodaySales = document.getElementById('statTodaySales');
    const statWeekSales = document.getElementById('statWeekSales');
    const statMonthSales = document.getElementById('statMonthSales');
    const statProfit = document.getElementById('statProfit');
    const countProducts = document.getElementById('countProducts');
    const countLowStock = document.getElementById('countLowStock');
    const countHotSale = document.getElementById('countHotSale');
    const dashboardStockTableBody = document.querySelector('#dashboardStockTable tbody');

    function refreshDashboard() {
      countProducts.textContent = 'Products: ' + products.length;
      const low = products.filter(p => p.stock <= p.lowStock).length;
      const hot = products.filter(p => p.hotSale).length;
      countLowStock.textContent = 'Low Stock: ' + low;
      countHotSale.textContent = 'Hot Sale: ' + hot;

      let todaySales = 0;
      let weekSales = 0;
      let monthSales = 0;
      let totalSales = 0;

      const now = new Date();
      const currentWeek = weekOfYear(now);
      const currentMonth = monthKey(now);

      invoices.forEach(inv => {
        const d = new Date(inv.date);
        const amount = inv.total;
        totalSales += amount;
        if (sameDay(d, now)) todaySales += amount;
        if (weekOfYear(d) === currentWeek && d.getFullYear() === now.getFullYear()) {
          weekSales += amount;
        }
        if (monthKey(d) === currentMonth) {
          monthSales += amount;
        }
      });

      let totalExpenses = 0;
      expenses.forEach(exp => { totalExpenses += exp.amount; });

      const profit = totalSales - totalExpenses;

      statTodaySales.textContent = todaySales.toFixed(2);
      statWeekSales.textContent = weekSales.toFixed(2);
      statMonthSales.textContent = monthSales.toFixed(2);
      statProfit.textContent = profit.toFixed(2);
      statProfit.className =
        'stat-value ' + (profit >= 0 ? 'stat-positive' : 'stat-negative');

      dashboardStockTableBody.innerHTML = '';
      products.forEach(p => {
        if (!(p.stock <= p.lowStock || p.hotSale)) return;
        const tr = document.createElement('tr');
        const tags = [];
        if (p.stock <= p.lowStock) tags.push('<span class="tag tag-low">Low</span>');
        if (p.hotSale) tags.push('<span class="tag tag-hot">Hot</span>');
        tr.innerHTML = `
          <td>${p.code}</td>
          <td>${p.name}</td>
          <td>${p.category}</td>
          <td>${p.stock}</td>
          <td>${tags.join(' ')}</td>
        `;
        dashboardStockTableBody.appendChild(tr);
      });
    }

    const setUser = document.getElementById('setUser');
    const setPass = document.getElementById('setPass');
    const btnSaveLogin = document.getElementById('btnSaveLogin');
    const btnExportData = document.getElementById('btnExportData');
    const btnClearAllData = document.getElementById('btnClearAllData');
    const btnImportData = document.getElementById('btnImportData');
    const backupJson = document.getElementById('backupJson');

    btnSaveLogin.addEventListener('click', () => {
      const u = setUser.value.trim();
      const p = setPass.value.trim();
      if (!u || !p) {
        alert('Username and password required');
        return;
      }
      localStorage.setItem(KEY_LOGIN, JSON.stringify({ username: u, password: p }));
      alert('Login updated. Use new credentials next time.');
    });

    btnExportData.addEventListener('click', () => {
      const data = {
        products,
        invoices,
        expenses,
        login: JSON.parse(localStorage.getItem(KEY_LOGIN) || 'null')
      };
      backupJson.value = JSON.stringify(data, null, 2);
      alert('Data exported to text area. Copy and save it.');
    });

    btnImportData.addEventListener('click', () => {
      if (!backupJson.value.trim()) {
        alert('Paste JSON data first');
        return;
      }
      try {
        const data = JSON.parse(backupJson.value);
        if (data.products) {
          products = data.products;
          saveProducts();
        }
        if (data.invoices) {
          invoices = data.invoices;
          saveInvoices();
        }
        if (data.expenses) {
          expenses = data.expenses;
          saveExpenses();
        }
        if (data.login) {
          localStorage.setItem(KEY_LOGIN, JSON.stringify(data.login));
        }
        alert('Data imported');
        refreshAll();
      } catch (e) {
        alert('Invalid JSON');
      }
    });

    btnClearAllData.addEventListener('click', () => {
      if (!confirm('This will clear all products, invoices, expenses and login. Continue?')) {
        return;
      }
      localStorage.removeItem(KEY_PRODUCTS);
      localStorage.removeItem(KEY_INVOICES);
      localStorage.removeItem(KEY_EXPENSES);
      localStorage.removeItem(KEY_LOGIN);
      products = [];
      invoices = [];
      expenses = [];
      cart = [];
      loadData();
      refreshAll();
      alert('All data cleared. Default login: admin / admin');
    });

    function refreshAll() {
      renderInventory();
      renderPosSearch();
      renderCart();
      renderExpenses();
      renderInvoices();
      refreshDashboard();
      const login = JSON.parse(localStorage.getItem(KEY_LOGIN) || 'null');
      if (login) {
        setUser.value = login.username;
        setPass.value = login.password;
      }
    }

    loadData();
    updateHeaderDate();
    refreshAll();
    const savedLang = localStorage.getItem(KEY_LANG) || "EN";
    applyLanguage(savedLang);
    document.getElementById("btnLangEN").addEventListener("click", () => { applyLanguage("EN"); });
    document.getElementById("btnLangUR").addEventListener("click", () => { applyLanguage("UR"); });

    (function setupPWA() {
      const svgIcon = `
        <svg xmlns="http://www.w3.org/2000/svg" width="512" height="512" viewBox="0 0 512 512">
          <defs>
            <linearGradient id="bg" x1="0" x2="0" y1="0" y2="1">
              <stop offset="0%" stop-color="#000000"/>
              <stop offset="100%" stop-color="#2b0b1a"/>
            </linearGradient>
            <linearGradient id="lip" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0%" stop-color="#ff9ac5"/>
              <stop offset="100%" stop-color="#ff4f9a"/>
            </linearGradient>
            <linearGradient id="ring" x1="0" x2="1" y1="0" y2="1">
              <stop offset="0%" stop-color="#ffd27f"/>
              <stop offset="100%" stop-color="#ffb300"/>
            </linearGradient>
          </defs>
          <rect width="512" height="512" fill="url(#bg)" rx="120" ry="120"/>
          <circle cx="340" cy="190" r="80" fill="none" stroke="url(#ring)" stroke-width="18"/>
          <circle cx="340" cy="190" r="50" fill="none" stroke="#000000" stroke-opacity="0.6" stroke-width="10"/>
          <rect x="140" y="160" width="80" height="210" rx="18" fill="#222222"/>
          <rect x="150" y="170" width="60" height="150" rx="12" fill="#444444"/>
          <path d="M140 160 L180 90 L220 160 Z" fill="url(#lip)"/>
          <rect x="160" y="180" width="18" height="120" rx="9" fill="#ffffff" fill-opacity="0.25"/>
          <text x="50%" y="430" text-anchor="middle" fill="#ff9ac5" font-size="44" font-family="Arial" font-weight="bold">
            Hoorian
          </text>
        </svg>
      `;
      const svgBlob = new Blob([svgIcon], { type: 'image/svg+xml' });
      const svgUrl = URL.createObjectURL(svgBlob);

      const manifest = {
        name: "Hoorian Cosmetics & Jewelry POS",
        short_name: "Hoorian POS",
        start_url: ".",
        display: "standalone",
        background_color: "#000000",
        theme_color: "#000000",
        icons: [
          { src: svgUrl, sizes: "192x192", type: "image/svg+xml", purpose: "any" },
          { src: svgUrl, sizes: "512x512", type: "image/svg+xml", purpose: "any maskable" }
        ]
      };
      const manifestBlob = new Blob([JSON.stringify(manifest)], { type: "application/json" });
      const manifestUrl = URL.createObjectURL(manifestBlob);
      const link = document.createElement("link");
      link.rel = "manifest";
      link.href = manifestUrl;
      document.head.appendChild(link);

      if ("serviceWorker" in navigator) {
        const swCode = `
          const CACHE_NAME = "hoorian-pos-cache-v1";
          const OFFLINE_URLS = ["./"];
          self.addEventListener("install", event => {
            event.waitUntil(
              caches.open(CACHE_NAME).then(cache => cache.addAll(OFFLINE_URLS))
            );
          });
          self.addEventListener("activate", event => {
            event.waitUntil(
              caches.keys().then(keys =>
                Promise.all(
                  keys.map(k => (k === CACHE_NAME ? null : caches.delete(k)))
                )
              )
            );
          });
          self.addEventListener("fetch", event => {
            event.respondWith(
              caches.match(event.request).then(resp => {
                return resp || fetch(event.request).catch(() => caches.match("./"));
              })
            );
          });
        `;
        const swBlob = new Blob([swCode], { type: "application/javascript" });
        const swUrl = URL.createObjectURL(swBlob);
        navigator.serviceWorker.register(swUrl).catch(() => {});
      }
    })();
  </script>
</body>
</html>
