<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Hoorian Cosmetics & Jewelry - POS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <style>
    :root {
      --bg-dark: #050509;
      --bg-card: #111018;
      --accent-pink: #ff4f9a;
      --accent-pink-soft: #ff9ac5;
      --text-main: #ffffff;
      --text-muted: #bbbbbb;
      --danger: #ff4f4f;
      --success: #4caf50;
      --border-color: #2a2433;
      --footer-bg: #08060d;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Arial, sans-serif;
      background: radial-gradient(circle at top, #1b1024 0, #050509 45%, #000000 100%);
      color: var(--text-main);
    }
    header {
      background: linear-gradient(90deg, #050509, #1f0b18, #050509);
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border-color);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .logo { display: flex; align-items: center; gap: 10px; }
    .logo-circle {
      width: 40px; height: 40px; border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ffffff, #ff4f9a, #000000);
      display: flex; align-items: center; justify-content: center;
      font-weight: 800; color: #000; font-size: 18px;
      box-shadow: 0 0 12px rgba(255,79,154,0.6);
    }
    .logo-text { display: flex; flex-direction: column; }
    .logo-text-main { font-size: 17px; font-weight: 700; letter-spacing: 0.4px; }
    .logo-text-sub { font-size: 11px; color: var(--accent-pink-soft); text-transform: uppercase; letter-spacing: 1px; }
    .header-right { font-size: 11px; color: var(--text-muted); text-align: right; }
    .header-right span { display: block; }
    .lang-toggle { margin-top: 4px; }
    .lang-toggle button {
      padding: 3px 8px; border-radius: 999px;
      border: 1px solid var(--accent-pink-soft);
      background: transparent; color: var(--accent-pink-soft);
      font-size: 11px; cursor: pointer;
    }
    .lang-toggle button.active {
      background: var(--accent-pink-soft);
      color: #000;
    }

    .container {
      display: flex;
      min-height: calc(100vh - 56px);
      padding-bottom: 52px; /* space for footer nav */
    }
    .sidebar {
      width: 230px; background: #050509;
      border-right: 1px solid var(--border-color);
      padding: 10px;
    }
    .sidebar h3 {
      margin-top: 0; font-size: 13px;
      text-transform: uppercase; color: var(--accent-pink-soft);
      letter-spacing: 1px;
    }
    .nav-btn {
      width: 100%; padding: 9px 10px; margin-bottom: 6px;
      border-radius: 6px; border: 1px solid var(--border-color);
      background: rgba(10,8,18,0.9); color: var(--text-main);
      text-align: left; cursor: pointer; font-size: 13px;
      display: flex; justify-content: space-between; align-items: center;
      backdrop-filter: blur(8px);
    }
    .nav-btn.active {
      background: linear-gradient(90deg, #ff4f9a, #ff9ac5);
      border-color: #ff4f9a;
      color: #000; font-weight: 700;
      box-shadow: 0 0 12px rgba(255,79,154,0.6);
    }
    .nav-btn span.badge {
      background: #1a1324; padding: 2px 6px;
      border-radius: 10px; font-size: 11px;
      color: var(--accent-pink-soft);
    }

    .main { flex: 1; padding: 12px; overflow-y: auto; }

    .card {
      background: radial-gradient(circle at top left, #1b1024 0, #0a0710 45%, #050509 100%);
      border-radius: 10px;
      padding: 12px 14px;
      margin-bottom: 12px;
      border: 1px solid var(--border-color);
      box-shadow: 0 10px 25px rgba(0,0,0,0.6);
    }
    .card h2 { margin: 0 0 10px 0; font-size: 16px; color: var(--accent-pink-soft); }
    .card h3 { margin: 0 0 8px 0; font-size: 14px; color: var(--accent-pink-soft); }

    label {
      display: block; margin-top: 6px;
      font-size: 12px; color: var(--text-muted);
    }
    input, select, textarea {
      width: 100%; padding: 7px; margin-top: 3px;
      border-radius: 6px; border: 1px solid var(--border-color);
      background: rgba(5,5,9,0.9); color: var(--text-main); font-size: 13px;
      outline: none;
    }
    input:focus, select:focus, textarea:focus {
      border-color: var(--accent-pink-soft);
      box-shadow: 0 0 0 1px rgba(255,79,154,0.4);
    }
    textarea { resize: vertical; min-height: 50px; }

    .row { display: flex; flex-wrap: wrap; gap: 10px; }
    .col-50 { flex: 1 1 48%; min-width: 220px; }
    .col-33 { flex: 1 1 32%; min-width: 180px; }

    .btn {
      padding: 8px 12px; border-radius: 999px;
      border: none; cursor: pointer;
      font-size: 13px; font-weight: 600;
      margin-top: 8px;
    }
    .btn-primary {
      background: linear-gradient(90deg, #ff4f9a, #ff9ac5);
      color: #000;
      box-shadow: 0 0 12px rgba(255,79,154,0.6);
    }
    .btn-secondary { background: #262033; color: var(--text-main); }
    .btn-danger { background: #b3261e; color: #fff; }
    .btn-small { padding: 4px 9px; font-size: 11px; border-radius: 999px; }

    table {
      width: 100%; border-collapse: collapse;
      font-size: 12px; margin-top: 8px;
    }
    th, td {
      border: 1px solid var(--border-color);
      padding: 5px; text-align: left;
    }
    th {
      background: #120c1b;
      color: var(--accent-pink-soft);
      position: sticky;
      top: 0;
      z-index: 1;
    }

    .tag {
      display: inline-block; padding: 2px 6px;
      border-radius: 10px; font-size: 10px;
      margin-right: 4px;
    }
    .tag-low { background: #3b0000; color: var(--danger); }
    .tag-hot { background: #002b12; color: var(--success); }

    .muted { color: var(--text-muted); font-size: 11px; }

    .stat-grid { display: flex; flex-wrap: wrap; gap: 10px; }
    .stat-card {
      flex: 1 1 24%; min-width: 150px;
      background: radial-gradient(circle at top, #22142f 0, #0a0710 60%);
      border-radius: 10px; padding: 8px;
      border: 1px solid var(--border-color);
      font-size: 12px;
      box-shadow: 0 8px 18px rgba(0,0,0,0.7);
    }
    .stat-label { color: var(--text-muted); font-size: 11px; }
    .stat-value { font-size: 16px; font-weight: 700; margin-top: 4px; }
    .stat-positive { color: var(--success); }
    .stat-negative { color: var(--danger); }
    .stat-sub { font-size: 10px; color: var(--text-muted); margin-top: 2px; }

    .pill {
      display: inline-block; padding: 2px 8px;
      border-radius: 999px; font-size: 11px;
      border: 1px solid var(--border-color);
      margin-right: 4px; margin-bottom: 4px;
      background: rgba(10,8,18,0.8);
    }
    .pill-active {
      background: var(--accent-pink);
      color: #000; border-color: var(--accent-pink);
    }

    .login-overlay {
      position: fixed; inset: 0;
      background: radial-gradient(circle at top, #1b1024 0, #050509 45%, #000000 100%);
      display: flex; align-items: center; justify-content: center;
      z-index: 999;
    }
    .login-box {
      background: radial-gradient(circle at top, #22142f 0, #050509 60%);
      padding: 20px;
      border-radius: 14px; width: 320px;
      border: 1px solid var(--accent-pink-soft);
      text-align: center;
      box-shadow: 0 18px 40px rgba(0,0,0,0.9);
    }
    .login-box h2 { margin-top: 0; color: var(--accent-pink-soft); }
    .login-box p { font-size: 12px; color: var(--text-muted); }

    .footer-nav {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      background: linear-gradient(90deg, #050509, #120c1b, #050509);
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: space-around;
      padding: 4px 0;
      z-index: 20;
    }
    .footer-btn {
      flex: 1;
      text-align: center;
      color: var(--text-muted);
      font-size: 11px;
      padding: 3px 0;
      cursor: pointer;
    }
    .footer-btn span.icon {
      display: block;
      font-size: 16px;
      margin-bottom: 1px;
    }
    .footer-btn.active {
      color: var(--accent-pink-soft);
      font-weight: 600;
    }

    @media (max-width: 900px) {
      .container { flex-direction: column; }
      .sidebar {
        width: 100%;
        display: flex;
        overflow-x: auto;
        padding-bottom: 6px;
      }
      .sidebar h3 { display: none; }
      .nav-btn { flex: 1 1 auto; white-space: nowrap; }
    }
  </style>
</head>
<body>
  <!-- LOGIN OVERLAY -->
  <div class="login-overlay" id="loginOverlay">
    <div class="login-box">
      <h2 data-key="login_title"></h2>
      <p data-key="login_subtitle"></p>
      <label data-key="login_username_label"></label>
      <input type="text" id="loginUser" placeholder="admin" />
      <label data-key="login_password_label"></label>
      <input type="password" id="loginPass" placeholder="admin" />
      <button class="btn btn-primary" style="width:100%;margin-top:12px;" id="loginBtn" data-key="login_button"></button>
      <p class="muted" style="margin-top:10px;" data-key="login_hint"></p>
    </div>
  </div>

  <!-- HEADER -->
  <header>
    <div class="logo">
      <div class="logo-circle">H</div>
      <div class="logo-text">
        <span class="logo-text-main" data-key="app_title"></span>
        <span class="logo-text-sub" data-key="app_subtitle"></span>
      </div>
    </div>
    <div class="header-right">
      <span id="headerUser"></span>
      <span id="headerDate"></span>
      <div class="lang-toggle">
        <button id="btnLangEN">EN</button>
        <button id="btnLangUR">UR</button>
      </div>
    </div>
  </header>

  <!-- MAIN LAYOUT -->
  <div class="container">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <h3 data-key="menu_title"></h3>
      <button class="nav-btn active" data-view="dashboardView">
        <span data-key="menu_dashboard"></span> <span class="badge" data-key="menu_dashboard_badge"></span>
      </button>
      <button class="nav-btn" data-view="inventoryView">
        <span data-key="menu_inventory"></span> <span class="badge" data-key="menu_inventory_badge"></span>
      </button>
      <button class="nav-btn" data-view="salesView">
        <span data-key="menu_sales"></span> <span class="badge" data-key="menu_sales_badge"></span>
      </button>
      <button class="nav-btn" data-view="expensesView">
        <span data-key="menu_expenses"></span> <span class="badge" data-key="menu_expenses_badge"></span>
      </button>
      <button class="nav-btn" data-view="invoicesView">
        <span data-key="menu_invoices"></span> <span class="badge" data-key="menu_invoices_badge"></span>
      </button>
      <button class="nav-btn" data-view="settingsView">
        <span data-key="menu_settings"></span> <span class="badge" data-key="menu_settings_badge"></span>
      </button>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main">
      <!-- DASHBOARD -->
      <section id="dashboardView" class="card">
        <h2 data-key="dashboard_title"></h2>
        <div class="row">
          <div class="col-50">
            <div class="stat-grid">
              <div class="stat-card">
                <div class="stat-label" data-key="stat_today_sales_label"></div>
                <div class="stat-value" id="statTodaySales">0.00</div>
                <div class="stat-sub" data-key="stat_today_sales_sub"></div>
              </div>
              <div class="stat-card">
                <div class="stat-label" data-key="stat_month_sales_label"></div>
                <div class="stat-value" id="statMonthSales">0.00</div>
                <div class="stat-sub" data-key="stat_month_sales_sub"></div>
              </div>
              <div class="stat-card">
                <div class="stat-label" data-key="stat_profit_label"></div>
                <div class="stat-value" id="statProfit">0.00</div>
                <div class="stat-sub" data-key="stat_profit_sub"></div>
              </div>
              <div class="stat-card">
                <div class="stat-label" data-key="stat_margin_label"></div>
                <div class="stat-value" id="statMargin">0%</div>
                <div class="stat-sub" data-key="stat_margin_sub"></div>
              </div>
            </div>
          </div>
          <div class="col-50">
            <h3 data-key="dashboard_quick_title"></h3>
            <p class="muted" data-key="dashboard_quick_text"></p>
            <div>
              <span class="pill" id="countProducts"></span>
              <span class="pill" id="countLowStock"></span>
              <span class="pill" id="countHotSale"></span>
              <span class="pill" id="countInvoices"></span>
            </div>
            <p class="muted" style="margin-top:10px;">
              üíÑ Lipsticks ‚Ä¢ üíç Jewelry ‚Ä¢ ü©≤ Undergarments ‚Äî sab ka stock, daily sale, monthly sale aur profit yahan se control karo.
            </p>
          </div>
        </div>

        <h3 style="margin-top:15px;" data-key="dashboard_stock_title"></h3>
        <table id="dashboardStockTable">
          <thead>
            <tr>
              <th data-key="tbl_code"></th>
              <th data-key="tbl_name"></th>
              <th data-key="tbl_category"></th>
              <th data-key="tbl_stock"></th>
              <th data-key="tbl_tags"></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </section>

      <!-- yahan se aage: Inventory, Sales, Expenses, Invoices, Settings, JS sab NEXT PARTS me aayega -->
            <!-- INVENTORY -->
      <section id="inventoryView" class="card" style="display:none;">
        <h2 data-key="inventory_title"></h2>

        <div class="row">
          <!-- LEFT SIDE: ADD / EDIT PRODUCT -->
          <div class="col-50">
            <h3 data-key="inventory_add_title"></h3>

            <label data-key="inventory_code_label"></label>
            <input type="text" id="invCode" />

            <label data-key="inventory_name_label"></label>
            <input type="text" id="invName" />

            <label data-key="inventory_category_label"></label>
            <select id="invCategory">
              <option value="Cosmetics" data-key="cat_cosmetics"></option>
              <option value="Jewelry" data-key="cat_jewelry"></option>
              <option value="Undergarments" data-key="cat_undergarments"></option>
            </select>

            <div class="row">
              <div class="col-50">
                <label data-key="inventory_stock_label"></label>
                <input type="number" id="invStock" min="0" value="0" />
              </div>
              <div class="col-50">
                <label data-key="inventory_lowstock_label"></label>
                <input type="number" id="invLowStock" min="0" value="5" />
              </div>
            </div>

            <div class="row">
              <div class="col-50">
                <label data-key="inventory_cost_label"></label>
                <input type="number" id="invCost" min="0" step="0.01" value="0" />
              </div>
              <div class="col-50">
                <label data-key="inventory_price_label"></label>
                <input type="number" id="invPrice" min="0" step="0.01" value="0" />
              </div>
            </div>

            <label>
              <input type="checkbox" id="invHotSale" />
              <span data-key="inventory_hotsale_label"></span>
            </label>

            <button class="btn btn-primary" id="btnSaveProduct" data-key="btn_save_product"></button>
            <button class="btn btn-secondary btn-small" id="btnClearProduct" data-key="btn_clear"></button>

            <p class="muted" data-key="inventory_tip"></p>
          </div>

          <!-- RIGHT SIDE: PRODUCT LIST -->
          <div class="col-50">
            <h3 data-key="inventory_list_title"></h3>

            <div class="row">
              <div class="col-50">
                <label data-key="inventory_search_label"></label>
                <input type="text" id="invSearch" />
              </div>

              <div class="col-50">
                <label data-key="inventory_filter_label"></label>
                <select id="invFilterCategory">
                  <option value="" data-key="filter_all"></option>
                  <option value="Cosmetics" data-key="cat_cosmetics"></option>
                  <option value="Jewelry" data-key="cat_jewelry"></option>
                  <option value="Undergarments" data-key="cat_undergarments"></option>
                </select>
              </div>
            </div>

            <table id="invTable">
              <thead>
                <tr>
                  <th data-key="tbl_code"></th>
                  <th data-key="tbl_name"></th>
                  <th data-key="tbl_category_short"></th>
                  <th data-key="tbl_stock"></th>
                  <th data-key="tbl_price"></th>
                  <th data-key="tbl_tags"></th>
                  <th data-key="tbl_action"></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>
            <!-- SALES / POS -->
      <section id="salesView" class="card" style="display:none;">
        <h2 data-key="sales_title"></h2>

        <div class="row">
          <!-- LEFT SIDE: SEARCH PRODUCTS -->
          <div class="col-50">
            <h3 data-key="sales_add_title"></h3>

            <label data-key="sales_search_label"></label>
            <input type="text" id="posSearch" />

            <table id="posSearchTable">
              <thead>
                <tr>
                  <th data-key="tbl_code"></th>
                  <th data-key="tbl_name"></th>
                  <th data-key="tbl_category_short"></th>
                  <th data-key="tbl_stock"></th>
                  <th data-key="tbl_price"></th>
                  <th data-key="tbl_add"></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <!-- RIGHT SIDE: CART -->
          <div class="col-50">
            <h3 data-key="sales_cart_title"></h3>

            <table id="cartTable">
              <thead>
                <tr>
                  <th data-key="tbl_item"></th>
                  <th data-key="tbl_qty"></th>
                  <th data-key="tbl_price"></th>
                  <th data-key="tbl_total"></th>
                  <th></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>

            <div style="margin-top:8px;">
              <span class="pill" id="cartItemsCount"></span>
              <span class="pill" id="cartTotalAmount"></span>
            </div>

            <label data-key="sales_customer_label"></label>
            <input type="text" id="cartCustomerName" />

            <label data-key="sales_notes_label"></label>
            <textarea id="cartNotes"></textarea>

            <button class="btn btn-primary" id="btnCheckout" data-key="btn_checkout"></button>
            <button class="btn btn-secondary btn-small" id="btnClearCart" data-key="btn_clear_cart"></button>
          </div>
        </div>
      </section>
            <!-- EXPENSES -->
      <section id="expensesView" class="card" style="display:none;">
        <h2 data-key="expenses_title"></h2>

        <div class="row">
          <!-- LEFT: ADD EXPENSE -->
          <div class="col-50">
            <h3 data-key="expenses_add_title"></h3>

            <label data-key="expenses_title_label"></label>
            <input type="text" id="expTitle" />

            <label data-key="expenses_amount_label"></label>
            <input type="number" id="expAmount" min="0" step="0.01" />

            <label data-key="expenses_date_label"></label>
            <input type="date" id="expDate" />

            <label data-key="expenses_note_label"></label>
            <textarea id="expNote"></textarea>

            <button class="btn btn-primary" id="btnAddExpense" data-key="btn_add_expense"></button>
          </div>

          <!-- RIGHT: EXPENSE LIST -->
          <div class="col-50">
            <h3 data-key="expenses_list_title"></h3>

            <table id="expTable">
              <thead>
                <tr>
                  <th data-key="tbl_date"></th>
                  <th data-key="tbl_title"></th>
                  <th data-key="tbl_amount"></th>
                  <th></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>

            <p class="muted">
              <span data-key="expenses_total_label"></span>
              <span id="expTotal">0.00</span> PKR
            </p>
          </div>
        </div>
      </section>

      <!-- INVOICES -->
      <section id="invoicesView" class="card" style="display:none;">
        <h2 data-key="invoices_title"></h2>

        <div class="row">
          <!-- LEFT: INVOICE LIST -->
          <div class="col-50">
            <h3 data-key="invoices_list_title"></h3>

            <label data-key="invoices_search_label"></label>
            <input type="text" id="invSearchInvoice" />

            <table id="invoiceTable">
              <thead>
                <tr>
                  <th data-key="tbl_invoice_no"></th>
                  <th data-key="tbl_date"></th>
                  <th data-key="tbl_customer"></th>
                  <th data-key="tbl_total"></th>
                  <th data-key="tbl_items"></th>
                  <th data-key="tbl_return"></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <!-- RIGHT: INVOICE DETAIL -->
          <div class="col-50">
            <h3 data-key="invoices_detail_title"></h3>
            <div id="invoiceDetail" class="muted" data-key="invoices_detail_placeholder"></div>
            <button class="btn btn-secondary btn-small" id="btnPrintSlip">Print Slip</button>
            <button class="btn btn-secondary btn-small" id="btnPrintA4">Print A4</button>
          </div>
        </div>
      </section>

      <!-- SETTINGS -->
      <section id="settingsView" class="card" style="display:none;">
        <h2 data-key="settings_title"></h2>

        <h3 data-key="settings_login_title"></h3>
        <label data-key="settings_user_label"></label>
        <input type="text" id="setUser" />
        <label data-key="settings_pass_label"></label>
        <input type="password" id="setPass" />
        <button class="btn btn-primary" id="btnSaveLogin" data-key="btn_save_login"></button>

        <h3 style="margin-top:15px;" data-key="settings_backup_title"></h3>
        <p class="muted" data-key="settings_backup_text"></p>

        <button class="btn btn-secondary btn-small" id="btnExportData" data-key="btn_export"></button>
        <button class="btn btn-danger btn-small" id="btnClearAllData" data-key="btn_clear_all"></button>

        <label data-key="settings_backup_label"></label>
        <textarea id="backupJson"></textarea>
        <button class="btn btn-primary btn-small" id="btnImportData" data-key="btn_import"></button>
      </section>
    </main>
  </div>

  <!-- FOOTER NAVIGATION -->
  <div class="footer-nav">
    <div class="footer-btn active" data-view="dashboardView">
      <span class="icon">üè†</span>
      <span>Home</span>
    </div>
    <div class="footer-btn" data-view="inventoryView">
      <span class="icon">üì¶</span>
      <span>Stock</span>
    </div>
    <div class="footer-btn" data-view="salesView">
      <span class="icon">üõí</span>
      <span>Sales</span>
    </div>
    <div class="footer-btn" data-view="invoicesView">
      <span class="icon">üìÑ</span>
      <span>Bills</span>
    </div>
    <div class="footer-btn" data-view="settingsView">
      <span class="icon">‚öôÔ∏è</span>
      <span>Settings</span>
    </div>
  </div>
    <script>
    // ---------- LANGUAGE PACKS ----------
    const langEN = {
      app_title: "Hoorian Cosmetics & Jewelry",
      app_subtitle: "beauty ‚Ä¢ shine ‚Ä¢ elegance",
      menu_title: "Menu",
      menu_dashboard: "Dashboard",
      menu_dashboard_badge: "Home",
      menu_inventory: "Inventory",
      menu_inventory_badge: "Stock",
      menu_sales: "Sales / POS",
      menu_sales_badge: "Cart",
      menu_expenses: "Expenses",
      menu_expenses_badge: "Cost",
      menu_invoices: "Invoices",
      menu_invoices_badge: "History",
      menu_settings: "Settings",
      menu_settings_badge: "Login",

      login_title: "Hoorian Cosmetics & Jewelry",
      login_subtitle: "Secure login for shop owner / staff.",
      login_username_label: "Username",
      login_password_label: "Password",
      login_button: "Login",
      login_hint: "Default login: admin / admin (local only).",

      dashboard_title: "Sales Dashboard",
      stat_today_sales_label: "Today Sales (PKR)",
      stat_today_sales_sub: "Aaj ki total sales (invoices se).",
      stat_month_sales_label: "This Month Sales (PKR)",
      stat_month_sales_sub: "Is month ki total sales.",
      stat_profit_label: "Total Profit (PKR)",
      stat_profit_sub: "Total Sales - Total Expenses.",
      stat_margin_label: "Profit Margin (%)",
      stat_margin_sub: "Profit √∑ Sales √ó 100.",
      dashboard_quick_title: "Quick Overview",
      dashboard_quick_text:
        "‚Ä¢ Daily & monthly sales invoices se auto calculate hoti hain.\n‚Ä¢ Profit expenses ko minus karke nikalta hai.\n‚Ä¢ Inventory se stock manage karein, Sales se invoices banayein.\n‚Ä¢ Sab data sirf is device ke browser mein localStorage mein save hota hai.",
      dashboard_stock_title: "Low Stock & Hot Sale Items",

      inventory_title: "Inventory & Stock",
      inventory_add_title: "Add / Edit Product",
      inventory_code_label: "QR / Code",
      inventory_name_label: "Product Name",
      inventory_category_label: "Category",
      inventory_stock_label: "Stock Quantity",
      inventory_lowstock_label: "Low Stock Level",
      inventory_cost_label: "Cost Price (PKR)",
      inventory_price_label: "Selling Price (PKR)",
      inventory_hotsale_label: "Mark as Hot Sale Item",
      btn_save_product: "Save / Update Product",
      btn_clear: "Clear",
      inventory_tip:
        "Tip: Use QR / Code field to scan or type product code quickly for search and sales.",
      inventory_list_title: "Inventory List",
      inventory_search_label: "Search by Name / Code",
      inventory_filter_label: "Filter Category",

      cat_cosmetics: "Cosmetics",
      cat_jewelry: "Jewelry",
      cat_undergarments: "Undergarments",
      filter_all: "All",

      sales_title: "Sales / POS",
      sales_add_title: "Add to Cart",
      sales_search_label: "Search Product (Name / Code)",
      sales_cart_title: "Cart",
      sales_customer_label: "Customer Name (optional)",
      sales_notes_label: "Notes (optional)",
      btn_checkout: "Checkout & Create Invoice",
      btn_clear_cart: "Clear Cart",

      expenses_title: "Shop Expenses",
      expenses_add_title: "Add Expense",
      expenses_title_label: "Title",
      expenses_amount_label: "Amount (PKR)",
      expenses_date_label: "Date",
      expenses_note_label: "Note",
      btn_add_expense: "Add Expense",
      expenses_list_title: "Expense List",
      expenses_total_label: "Total Expenses:",

      invoices_title: "Invoices & Returns",
      invoices_list_title: "Invoice List",
      invoices_search_label: "Search by Invoice / Customer",
      invoices_detail_title: "Invoice Detail",
      invoices_detail_placeholder: "Select an invoice to view details.",

      settings_title: "Settings & Backup",
      settings_login_title: "Login Settings",
      settings_user_label: "Change Username",
      settings_pass_label: "Change Password",
      btn_save_login: "Save Login",
      settings_backup_title: "Data Backup (Manual)",
      settings_backup_text:
        "You can copy JSON data below and save it somewhere safe. Later you can paste it back to restore.",
      btn_export: "Export Data",
      btn_clear_all: "Clear All Data",
      settings_backup_label: "Backup / Restore JSON",
      btn_import: "Import Data",

      tbl_code: "Code",
      tbl_name: "Name",
      tbl_category: "Category",
      tbl_category_short: "Cat",
      tbl_stock: "Stock",
      tbl_price: "Price (PKR)",
      tbl_tags: "Tags",
      tbl_action: "Action",
      tbl_add: "Add",
      tbl_item: "Item",
      tbl_qty: "Qty",
      tbl_total: "Total (PKR)",
      tbl_date: "Date",
      tbl_title: "Title",
      tbl_amount: "Amount (PKR)",
      tbl_invoice_no: "No.",
      tbl_customer: "Customer",
      tbl_items: "Items",
      tbl_return: "Return"
    };

    const langUR = {
      app_title: "Hoorian Cosmetics & Jewelry",
      app_subtitle: "beauty ‚Ä¢ shine ‚Ä¢ elegance",
      menu_title: "Menu",
      menu_dashboard: "Dashboard",
      menu_dashboard_badge: "Home",
      menu_inventory: "Inventory (Saman)",
      menu_inventory_badge: "Stock",
      menu_sales: "Sales / POS (Sale)",
      menu_sales_badge: "Cart",
      menu_expenses: "Kharchay",
      menu_expenses_badge: "Cost",
      menu_invoices: "Invoices (Bills)",
      menu_invoices_badge: "History",
      menu_settings: "Settings",
      menu_settings_badge: "Login",

      login_title: "Hoorian Cosmetics & Jewelry",
      login_subtitle: "Shop owner / staff ka secure login.",
      login_username_label: "Username (Naam)",
      login_password_label: "Password",
      login_button: "Login",
      login_hint: "Default login: admin / admin (sirf is device par).",

      dashboard_title: "Sales Dashboard (Sales ka Jayeza)",
      stat_today_sales_label: "Aaj ki Sales (PKR)",
      stat_today_sales_sub: "Sirf aaj ke invoices ki total.",
      stat_month_sales_label: "Is Month ki Sales (PKR)",
      stat_month_sales_sub: "Is month ke sab invoices ki total.",
      stat_profit_label: "Total Profit (PKR)",
      stat_profit_sub: "Total Sales - Total Kharchay.",
      stat_margin_label: "Profit Margin (%)",
      stat_margin_sub: "Profit ko Sales se divide karke percentage.",
      dashboard_quick_title: "Quick Overview (Mukhtasar Jayeza)",
      dashboard_quick_text:
        "‚Ä¢ Daily & monthly sales invoices se auto calculate hoti hain.\n‚Ä¢ Profit kharchay minus karke nikalta hai.\n‚Ä¢ Inventory se products add karein, Sales se invoices banayein.\n‚Ä¢ Saara data sirf is browser mein localStorage mein save hota hai.",
      dashboard_stock_title: "Low Stock & Hot Sale Items",

      inventory_title: "Inventory & Stock (Saman ka Record)",
      inventory_add_title: "Product Add / Edit Karein",
      inventory_code_label: "QR / Code (Number)",
      inventory_name_label: "Product Ka Naam",
      inventory_category_label: "Category (Qism)",
      inventory_stock_label: "Stock Quantity (Kitna Saman)",
      inventory_lowstock_label: "Low Stock Level (Kam Stock Limit)",
      inventory_cost_label: "Cost Price (PKR) (Khareed Rate)",
      inventory_price_label: "Selling Price (PKR) (Sale Rate)",
      inventory_hotsale_label: "Isay Hot Sale Item mark karein",
      btn_save_product: "Product Save / Update Karein",
      btn_clear: "Clear (Saaf)",
      inventory_tip:
        "Tip: QR / Code field mein code type ya scan karein, search aur sale dono asaan ho jayein ge.",
      inventory_list_title: "Inventory List (Products ki List)",
      inventory_search_label: "Name / Code se Search karein",
      inventory_filter_label: "Category Filter",

      cat_cosmetics: "Cosmetics",
      cat_jewelry: "Jewelry",
      cat_undergarments: "Undergarments",
      filter_all: "Sab",

      sales_title: "Sales / POS (Sale System)",
      sales_add_title: "Cart mein Item Add Karein",
      sales_search_label: "Product Search (Name / Code)",
      sales_cart_title: "Cart (Jo Bechna hai)",
      sales_customer_label: "Customer Name (optional)",
      sales_notes_label: "Note (agar kuch likhna ho)",
      btn_checkout: "Checkout & Invoice Banayein",
      btn_clear_cart: "Cart Clear Karein",

      expenses_title: "Shop Kharchay",
      expenses_add_title: "Naya Kharcha Add Karein",
      expenses_title_label: "Title (Jaise Rent, Salary)",
      expenses_amount_label: "Amount (PKR)",
      expenses_date_label: "Date (Tareekh)",
      expenses_note_label: "Note (Zaroori ho to)",
      btn_add_expense: "Kharcha Add Karein",
      expenses_list_title: "Kharchon ki List",
      expenses_total_label: "Total Kharchay:",

      invoices_title: "Invoices & Returns (Bills aur Wapsi)",
      invoices_list_title: "Invoices ki List",
      invoices_search_label: "Invoice / Customer se Search karein",
      invoices_detail_title: "Invoice Detail",
      invoices_detail_placeholder: "Detail dekhne ke liye koi invoice select karein.",

      settings_title: "Settings & Backup",
      settings_login_title: "Login Settings",
      settings_user_label: "Username change karein",
      settings_pass_label: "Password change karein",
      btn_save_login: "Login Save Karein",
      settings_backup_title: "Data Backup (Manual)",
      settings_backup_text:
        "Neeche JSON data copy karke safe jagah par save karein. Baad mein paste karke restore kar sakte hain.",
      btn_export: "Data Export Karein",
      btn_clear_all: "Saara Data Clear Karein",
      settings_backup_label: "Backup / Restore JSON",
      btn_import: "Data Import Karein",

      tbl_code: "Code",
      tbl_name: "Naam",
      tbl_category: "Category",
      tbl_category_short: "Cat",
      tbl_stock: "Stock",
      tbl_price: "Price (PKR)",
      tbl_tags: "Tags",
      tbl_action: "Action",
      tbl_add: "Add",
      tbl_item: "Item",
      tbl_qty: "Qty",
      tbl_total: "Total (PKR)",
      tbl_date: "Date",
      tbl_title: "Title",
      tbl_amount: "Amount (PKR)",
      tbl_invoice_no: "No.",
      tbl_customer: "Customer",
      tbl_items: "Items",
      tbl_return: "Return"
    };

    const KEY_LANG = "hoorian_lang";
    const KEY_PRODUCTS = "hoorian_products";
    const KEY_INVOICES = "hoorian_invoices";
    const KEY_EXPENSES = "hoorian_expenses";
    const KEY_LOGIN = "hoorian_login";

    let products = [];
    let invoices = [];
    let expenses = [];
    let cart = [];
    window.currentUser = null;

    function applyLanguage(lang) {
      const dict = lang === "UR" ? langUR : langEN;
      document.querySelectorAll("[data-key]").forEach(el => {
        const key = el.getAttribute("data-key");
        if (dict[key] !== undefined) el.textContent = dict[key];
      });
      const headerUser = document.getElementById("headerUser");
      if (headerUser && window.currentUser) {
        headerUser.textContent = "User: " + window.currentUser;
      }
      document.getElementById("btnLangEN").classList.toggle("active", lang === "EN");
      document.getElementById("btnLangUR").classList.toggle("active", lang === "UR");
      localStorage.setItem(KEY_LANG, lang);
    }

    function loadData() {
      products = JSON.parse(localStorage.getItem(KEY_PRODUCTS) || "[]");
      invoices = JSON.parse(localStorage.getItem(KEY_INVOICES) || "[]");
      expenses = JSON.parse(localStorage.getItem(KEY_EXPENSES) || "[]");
      const login = JSON.parse(localStorage.getItem(KEY_LOGIN) || "null");
      if (!login) {
        localStorage.setItem(KEY_LOGIN, JSON.stringify({ username: "admin", password: "admin" }));
      }
      if (products.length === 0) {
        products = [
          { code: "LIP-RED-01", name: "Matte Lipstick Red", category: "Cosmetics", stock: 20, lowStock: 5, cost: 300, price: 750, hotSale: true },
          { code: "LIP-NUDE-02", name: "Nude Lipstick", category: "Cosmetics", stock: 15, lowStock: 5, cost: 280, price: 700, hotSale: true },
          { code: "JR-RING-01", name: "Gold Plated Ring", category: "Jewelry", stock: 10, lowStock: 3, cost: 1200, price: 2500, hotSale: true },
          { code: "JR-SET-01", name: "Bridal Jewelry Set", category: "Jewelry", stock: 5, lowStock: 2, cost: 3500, price: 6500, hotSale: false },
          { code: "UG-BRA-01", name: "Comfort Bra", category: "Undergarments", stock: 25, lowStock: 8, cost: 400, price: 900, hotSale: false },
          { code: "UG-SET-01", name: "Ladies Undergarment Set", category: "Undergarments", stock: 18, lowStock: 5, cost: 600, price: 1300, hotSale: true }
        ];
        saveProducts();
      }
    }

    function saveProducts() { localStorage.setItem(KEY_PRODUCTS, JSON.stringify(products)); }
    function saveInvoices() { localStorage.setItem(KEY_INVOICES, JSON.stringify(invoices)); }
    function saveExpenses() { localStorage.setItem(KEY_EXPENSES, JSON.stringify(expenses)); }

    function formatDate(d) {
      const dt = new Date(d);
      if (isNaN(dt)) return "";
      return dt.toISOString().slice(0, 10);
    }
    function todayStr() { return new Date().toISOString().slice(0, 10); }
    function sameDay(d1, d2) { return formatDate(d1) === formatDate(d2); }
    function monthKey(date) { return date.getFullYear() + "-" + (date.getMonth() + 1); }

    function generateInvoiceNumber() {
      const base = "INV";
      const num = invoices.length + 1;
      return base + String(num).padStart(4, "0");
    }

    function updateHeaderDate() {
      const el = document.getElementById("headerDate");
      const now = new Date();
      el.textContent = now.toLocaleString();
    }
    setInterval(updateHeaderDate, 60000);
      // ---------- LOGIN ----------
    const loginOverlay = document.getElementById("loginOverlay");

    document.getElementById("loginBtn").addEventListener("click", () => {
      const u = document.getElementById("loginUser").value.trim() || "admin";
      const p = document.getElementById("loginPass").value.trim() || "admin";

      const login = JSON.parse(localStorage.getItem(KEY_LOGIN) || "null");

      if (login && login.username === u && login.password === p) {
        window.currentUser = u;
        loginOverlay.style.display = "none";

        const lang = localStorage.getItem(KEY_LANG) || "EN";
        document.getElementById("headerUser").textContent = "User: " + window.currentUser;
        applyLanguage(lang);
      } else {
        alert("Wrong username or password");
      }
    });

    // ---------- NAVIGATION ----------
    const navButtons = document.querySelectorAll(".nav-btn");
    const views = {
      dashboardView: document.getElementById("dashboardView"),
      inventoryView: document.getElementById("inventoryView"),
      salesView: document.getElementById("salesView"),
      expensesView: document.getElementById("expensesView"),
      invoicesView: document.getElementById("invoicesView"),
      settingsView: document.getElementById("settingsView")
    };

    navButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const view = btn.getAttribute("data-view");
        showView(view);
      });
    });

    const footerBtns = document.querySelectorAll(".footer-btn");
    footerBtns.forEach(btn => {
      btn.addEventListener("click", () => {
        const view = btn.getAttribute("data-view");
        showView(view);
      });
    });

    function showView(view) {
      Object.keys(views).forEach(v => {
        views[v].style.display = v === view ? "block" : "none";
      });

      navButtons.forEach(b =>
        b.classList.toggle("active", b.getAttribute("data-view") === view)
      );

      footerBtns.forEach(b =>
        b.classList.toggle("active", b.getAttribute("data-view") === view)
      );

      refreshAll();
    }

    // ---------- INVENTORY FORM ----------
    const invCode = document.getElementById("invCode");
    const invName = document.getElementById("invName");
    const invCategory = document.getElementById("invCategory");
    const invStock = document.getElementById("invStock");
    const invLowStock = document.getElementById("invLowStock");
    const invCost = document.getElementById("invCost");
    const invPrice = document.getElementById("invPrice");
    const invHotSale = document.getElementById("invHotSale");

    const invTableBody = document.querySelector("#invTable tbody");
    const invSearch = document.getElementById("invSearch");
    const invFilterCategory = document.getElementById("invFilterCategory");

    let editingProductCode = null;

    function renderInventory() {
      invTableBody.innerHTML = "";

      const search = invSearch.value.trim().toLowerCase();
      const cat = invFilterCategory.value;

      products.forEach(p => {
        if (
          (search &&
            !(
              p.name.toLowerCase().includes(search) ||
              p.code.toLowerCase().includes(search)
            )) ||
          (cat && p.category !== cat)
        ) return;

        const tr = document.createElement("tr");

        const tags = [];
        if (p.stock <= p.lowStock) tags.push('<span class="tag tag-low">Low</span>');
        if (p.hotSale) tags.push('<span class="tag tag-hot">Hot</span>');

        tr.innerHTML = `
          <td>${p.code}</td>
          <td>${p.name}</td>
          <td>${p.category}</td>
          <td>${p.stock}</td>
          <td>${p.price.toFixed(0)}</td>
          <td>${tags.join(" ")}</td>
          <td>
            <button class="btn btn-secondary btn-small" data-code="${p.code}" data-action="edit">Edit</button>
            <button class="btn btn-danger btn-small" data-code="${p.code}" data-action="delete">X</button>
          </td>
        `;

        invTableBody.appendChild(tr);
      });
    }

    // ---------- SAVE PRODUCT ----------
    document.getElementById("btnSaveProduct").addEventListener("click", () => {
      const code = invCode.value.trim();
      const name = invName.value.trim();

      if (!code || !name) {
        alert("Code and Name required");
        return;
      }

      const category = invCategory.value;
      const stock = parseInt(invStock.value || "0", 10);
      const lowStock = parseInt(invLowStock.value || "0", 10);
      const cost = parseFloat(invCost.value || "0");
      const price = parseFloat(invPrice.value || "0");
      const hotSale = invHotSale.checked;

      const existingIndex = products.findIndex(p => p.code === code);

      if (existingIndex >= 0 && editingProductCode !== code) {
        alert("Code already exists. Use Edit or change code.");
        return;
      }

      const product = { code, name, category, stock, lowStock, cost, price, hotSale };

      if (editingProductCode && editingProductCode === code) {
        const idx = products.findIndex(p => p.code === editingProductCode);
        if (idx >= 0) products[idx] = product;
      } else if (editingProductCode && editingProductCode !== code) {
        const idx = products.findIndex(p => p.code === editingProductCode);
        if (idx >= 0) products.splice(idx, 1, product);
        else products.push(product);
      } else {
        products.push(product);
      }

      saveProducts();
      clearProductForm();
      renderInventory();
      refreshDashboard();
      alert("Product saved");
    });

    function clearProductForm() {
      editingProductCode = null;
      invCode.value = "";
      invName.value = "";
      invCategory.value = "Cosmetics";
      invStock.value = "0";
      invLowStock.value = "5";
      invCost.value = "0";
      invPrice.value = "0";
      invHotSale.checked = false;
    }

    document.getElementById("btnClearProduct").addEventListener("click", clearProductForm);

    // ---------- EDIT / DELETE ----------
    invTableBody.addEventListener("click", e => {
      const btn = e.target.closest("button");
      if (!btn) return;

      const code = btn.getAttribute("data-code");
      const action = btn.getAttribute("data-action");

      const idx = products.findIndex(p => p.code === code);
      if (idx < 0) return;

      if (action === "edit") {
        const p = products[idx];
        editingProductCode = p.code;

        invCode.value = p.code;
        invName.value = p.name;
        invCategory.value = p.category;
        invStock.value = p.stock;
        invLowStock.value = p.lowStock;
        invCost.value = p.cost;
        invPrice.value = p.price;
        invHotSale.checked = p.hotSale;

      } else if (action === "delete") {
        if (confirm("Delete product " + products[idx].name + "?")) {
          products.splice(idx, 1);
          saveProducts();
          renderInventory();
          refreshDashboard();
        }
      }
    });

    invSearch.addEventListener("input", renderInventory);
    invFilterCategory.addEventListener("change", renderInventory);
        /* -------------------------
       SALES / POS SYSTEM
    --------------------------*/

    const posSearch = document.getElementById("posSearch");
    const posSearchTableBody = document.querySelector("#posSearchTable tbody");

    const cartTableBody = document.querySelector("#cartTable tbody");
    const cartItemsCount = document.getElementById("cartItemsCount");
    const cartTotalAmount = document.getElementById("cartTotalAmount");

    const cartCustomerName = document.getElementById("cartCustomerName");
    const cartNotes = document.getElementById("cartNotes");

    // SEARCH PRODUCTS FOR POS
    function renderPosSearch() {
      posSearchTableBody.innerHTML = "";

      const search = posSearch.value.trim().toLowerCase();

      products.forEach(p => {
        if (
          search &&
          !(
            p.name.toLowerCase().includes(search) ||
            p.code.toLowerCase().includes(search)
          )
        ) return;

        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${p.code}</td>
          <td>${p.name}</td>
          <td>${p.category}</td>
          <td>${p.stock}</td>
          <td>${p.price.toFixed(0)}</td>
          <td><button class="btn btn-primary btn-small" data-code="${p.code}">Add</button></td>
        `;

        posSearchTableBody.appendChild(tr);
      });
    }

    posSearch.addEventListener("input", renderPosSearch);

    // ADD TO CART
    posSearchTableBody.addEventListener("click", e => {
      const btn = e.target.closest("button");
      if (!btn) return;

      const code = btn.getAttribute("data-code");
      const product = products.find(p => p.code === code);

      if (!product) return;

      if (product.stock <= 0) {
        alert("No stock available for this item");
        return;
      }

      const existing = cart.find(c => c.code === code);

      if (existing) {
        if (existing.qty + 1 > product.stock) {
          alert("Not enough stock");
          return;
        }
        existing.qty += 1;
      } else {
        cart.push({
          code: product.code,
          name: product.name,
          price: product.price,
          qty: 1
        });
      }

      renderCart();
    });

    // RENDER CART
    function renderCart() {
      cartTableBody.innerHTML = "";

      let total = 0;

      cart.forEach((item, index) => {
        const lineTotal = item.qty * item.price;
        total += lineTotal;

        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td>${item.name}</td>
          <td>
            <input type="number" min="1" value="${item.qty}" data-index="${index}" class="cart-qty" style="width:60px;" />
          </td>
          <td>${item.price.toFixed(0)}</td>
          <td>${lineTotal.toFixed(0)}</td>
          <td><button class="btn btn-danger btn-small" data-index="${index}">X</button></td>
        `;

        cartTableBody.appendChild(tr);
      });

      cartItemsCount.textContent = "Items: " + cart.length;
      cartTotalAmount.textContent = "Total: " + total.toFixed(0) + " PKR";
    }

    // CHANGE QTY IN CART
    cartTableBody.addEventListener("input", e => {
      if (e.target.classList.contains("cart-qty")) {
        const index = parseInt(e.target.getAttribute("data-index"), 10);
        const qty = parseInt(e.target.value || "1", 10);

        if (isNaN(qty) || qty <= 0) return;

        const item = cart[index];
        const product = products.find(p => p.code === item.code);

        if (!product) return;

        if (qty > product.stock) {
          alert("Not enough stock");
          e.target.value = product.stock;
          cart[index].qty = product.stock;
        } else {
          cart[index].qty = qty;
        }

        renderCart();
      }
    });

    // REMOVE ITEM FROM CART
    cartTableBody.addEventListener("click", e => {
      const btn = e.target.closest("button");
      if (!btn) return;

      const index = parseInt(btn.getAttribute("data-index"), 10);
      cart.splice(index, 1);

      renderCart();
    });

    // CLEAR CART
    document.getElementById("btnClearCart").addEventListener("click", () => {
      if (confirm("Clear cart?")) {
        cart = [];
        renderCart();
      }
    });

    // CHECKOUT
    document.getElementById("btnCheckout").addEventListener("click", () => {
      if (cart.length === 0) {
        alert("Cart is empty");
        return;
      }

      let total = 0;
      cart.forEach(item => {
        total += item.qty * item.price;
      });

      const invoiceNo = generateInvoiceNumber();
      const now = new Date();

      const invoice = {
        number: invoiceNo,
        date: now.toISOString(),
        customer: cartCustomerName.value.trim() || "Walk-in",
        notes: cartNotes.value.trim(),
        items: cart.map(c => ({ ...c })),
        total: total,
        returned: false
      };

      invoices.push(invoice);
      saveInvoices();

      // REDUCE STOCK
      cart.forEach(item => {
        const p = products.find(p => p.code === item.code);
        if (p) {
          p.stock -= item.qty;
          if (p.stock < 0) p.stock = 0;
        }
      });

      saveProducts();

      alert("Invoice created: " + invoiceNo);

      // RESET CART
      cart = [];
      cartCustomerName.value = "";
      cartNotes.value = "";

      renderCart();
      renderInventory();
      refreshDashboard();
      renderInvoices();
    });
        /* -------------------------
       EXPENSES SYSTEM
    --------------------------*/

    const expTitle = document.getElementById("expTitle");
    const expAmount = document.getElementById("expAmount");
    const expDate = document.getElementById("expDate");
    const expNote = document.getElementById("expNote");

    const expTableBody = document.querySelector("#expTable tbody");
    const expTotal = document.getElementById("expTotal");

    document.getElementById("btnAddExpense").addEventListener("click", () => {
      const title = expTitle.value.trim();
      const amount = parseFloat(expAmount.value || "0");
      const date = expDate.value || todayStr();

      if (!title || amount <= 0) {
        alert("Title and amount required");
        return;
      }

      expenses.push({
        id: Date.now(),
        title,
        amount,
        date,
        note: expNote.value.trim()
      });

      saveExpenses();

      expTitle.value = "";
      expAmount.value = "";
      expDate.value = "";
      expNote.value = "";

      renderExpenses();
      refreshDashboard();
    });

    function renderExpenses() {
      expTableBody.innerHTML = "";
      let total = 0;

      expenses.forEach(exp => {
        total += exp.amount;

        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${formatDate(exp.date)}</td>
          <td>${exp.title}</td>
          <td>${exp.amount.toFixed(0)}</td>
          <td><button class="btn btn-danger btn-small" data-id="${exp.id}">X</button></td>
        `;

        expTableBody.appendChild(tr);
      });

      expTotal.textContent = total.toFixed(0);
    }

    expTableBody.addEventListener("click", e => {
      const btn = e.target.closest("button");
      if (!btn) return;

      const id = parseInt(btn.getAttribute("data-id"), 10);
      const idx = expenses.findIndex(exp => exp.id === id);

      if (idx >= 0 && confirm("Delete this expense?")) {
        expenses.splice(idx, 1);
        saveExpenses();
        renderExpenses();
        refreshDashboard();
      }
    });

    /* -------------------------
       INVOICE LIST + RETURN
    --------------------------*/

    const invoiceTableBody = document.querySelector("#invoiceTable tbody");
    const invoiceDetail = document.getElementById("invoiceDetail");
    const invSearchInvoice = document.getElementById("invSearchInvoice");

    function renderInvoices() {
      invoiceTableBody.innerHTML = "";

      const search = invSearchInvoice.value.trim().toLowerCase();

      invoices.forEach((inv, index) => {
        if (
          search &&
          !(
            inv.number.toLowerCase().includes(search) ||
            inv.customer.toLowerCase().includes(search)
          )
        ) return;

        const tr = document.createElement("tr");

        tr.innerHTML = `
          <td><button class="btn btn-secondary btn-small" data-index="${index}" data-action="view">${inv.number}</button></td>
          <td>${formatDate(inv.date)}</td>
          <td>${inv.customer}</td>
          <td>${inv.total.toFixed(0)}</td>
          <td>${inv.items.length}</td>
          <td>
            ${
              inv.returned
                ? '<span class="tag tag-low">Returned</span>'
                : '<button class="btn btn-danger btn-small" data-index="' +
                  index +
                  '" data-action="return">Return</button>'
            }
          </td>
        `;

        invoiceTableBody.appendChild(tr);
      });

      document.getElementById("countInvoices").textContent =
        "Invoices: " + invoices.length;
    }
    /* -------------------------
       INVOICE DETAIL VIEW
    --------------------------*/

    function showInvoiceDetail(inv) {
      let html = "";

      html += "<div><strong>Invoice:</strong> " + inv.number + "</div>";
      html += "<div><strong>Date:</strong> " + formatDate(inv.date) + "</div>";
      html += "<div><strong>Customer:</strong> " + inv.customer + "</div>";
      html += "<div><strong>Total:</strong> " + inv.total.toFixed(0) + " PKR</div>";
      html += "<div><strong>Returned:</strong> " + (inv.returned ? "Yes" : "No") + "</div>";

      if (inv.notes) {
        html += "<div><strong>Notes:</strong> " + inv.notes + "</div>";
      }

      html += "<h4 style='margin-top:8px;'>Items</h4>";
      html += "<table style='width:100%;font-size:12px;border-collapse:collapse;'>";
      html += "<tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th></tr>";

      inv.items.forEach(it => {
        html += `
          <tr>
            <td>${it.name}</td>
            <td>${it.qty}</td>
            <td>${it.price.toFixed(0)}</td>
            <td>${(it.qty * it.price).toFixed(0)}</td>
          </tr>
        `;
      });

      html += "</table>";

      invoiceDetail.innerHTML = html;
      currentInvoiceForPrint = inv;
    }

    invSearchInvoice.addEventListener("input", renderInvoices);

    /* -------------------------
       DASHBOARD (Daily + Monthly + Profit)
    --------------------------*/

    const statTodaySales = document.getElementById("statTodaySales");
    const statMonthSales = document.getElementById("statMonthSales");
    const statProfit = document.getElementById("statProfit");
    const statMargin = document.getElementById("statMargin");

    const countProducts = document.getElementById("countProducts");
    const countLowStock = document.getElementById("countLowStock");
    const countHotSale = document.getElementById("countHotSale");

    const dashboardStockTableBody = document.querySelector("#dashboardStockTable tbody");

    function refreshDashboard() {
      countProducts.textContent = "Products: " + products.length;

      const low = products.filter(p => p.stock <= p.lowStock).length;
      const hot = products.filter(p => p.hotSale).length;

      countLowStock.textContent = "Low Stock: " + low;
      countHotSale.textContent = "Hot Sale: " + hot;

      let todaySales = 0;
      let monthSales = 0;
      let totalSales = 0;

      const now = new Date();
      const currentMonth = monthKey(now);

      invoices.forEach(inv => {
        const d = new Date(inv.date);
        const amount = inv.total;

        totalSales += amount;

        if (sameDay(d, now)) todaySales += amount;
        if (monthKey(d) === currentMonth) monthSales += amount;
      });

      let totalExpenses = 0;
      expenses.forEach(exp => (totalExpenses += exp.amount));

      const profit = totalSales - totalExpenses;
      const margin = totalSales > 0 ? (profit / totalSales) * 100 : 0;

      statTodaySales.textContent = todaySales.toFixed(0);
      statMonthSales.textContent = monthSales.toFixed(0);

      statProfit.textContent = profit.toFixed(0);
      statProfit.className =
        "stat-value " + (profit >= 0 ? "stat-positive" : "stat-negative");

      statMargin.textContent = margin.toFixed(1) + "%";

      dashboardStockTableBody.innerHTML = "";

      products.forEach(p => {
        if (!(p.stock <= p.lowStock || p.hotSale)) return;

        const tr = document.createElement("tr");

        const tags = [];
        if (p.stock <= p.lowStock) tags.push('<span class="tag tag-low">Low</span>');
        if (p.hotSale) tags.push('<span class="tag tag-hot">Hot</span>');

        tr.innerHTML = `
          <td>${p.code}</td>
          <td>${p.name}</td>
          <td>${p.category}</td>
          <td>${p.stock}</td>
          <td>${tags.join(" ")}</td>
        `;

        dashboardStockTableBody.appendChild(tr);
      });
    }
          /* -------------------------
       PRINTING (Slip + A4)
    --------------------------*/

    let currentInvoiceForPrint = null;

    function openPrintWindow(html, title) {
      const w = window.open("", "_blank", "width=600,height=800");

      if (!w) {
        alert("Popup blocked. Allow popups to print.");
        return;
      }

      w.document.write(`
        <html>
          <head>
            <title>${title}</title>
            <style>
              body { font-family: Arial, sans-serif; font-size: 12px; }
              table { width: 100%; border-collapse: collapse; }
              th, td { border: 1px solid #000; padding: 4px; }
              h3 { margin: 4px 0; }
            </style>
          </head>
          <body>${html}</body>
        </html>
      `);

      w.document.close();
      w.focus();
      w.print();
    }

    // PRINT SLIP
    document.getElementById("btnPrintSlip").addEventListener("click", () => {
      if (!currentInvoiceForPrint) {
        alert("Select an invoice first");
        return;
      }

      const inv = currentInvoiceForPrint;

      let html = "";
      html += "<h3 style='text-align:center;'>Hoorian Cosmetics & Jewelry</h3>";
      html += "<hr/>";
      html += "<div>Invoice: " + inv.number + "</div>";
      html += "<div>Date: " + formatDate(inv.date) + "</div>";
      html += "<div>Customer: " + inv.customer + "</div>";
      html += "<hr/>";
      html += "<table>";
      html += "<tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th></tr>";

      let total = 0;

      inv.items.forEach(it => {
        const line = it.qty * it.price;
        total += line;

        html += `
          <tr>
            <td>${it.name}</td>
            <td>${it.qty}</td>
            <td>${it.price.toFixed(0)}</td>
            <td>${line.toFixed(0)}</td>
          </tr>
        `;
      });

      html += "</table>";
      html += "<hr/>";
      html += "<strong>Total: " + total.toFixed(0) + " PKR</strong>";

      openPrintWindow(html, "Invoice Slip");
    });

    // PRINT A4
    document.getElementById("btnPrintA4").addEventListener("click", () => {
      if (!currentInvoiceForPrint) {
        alert("Select an invoice first");
        return;
      }

      const inv = currentInvoiceForPrint;

      let html = "";
      html += "<h2>Hoorian Cosmetics & Jewelry</h2>";
      html += "<hr/>";
      html += "<div><strong>Invoice:</strong> " + inv.number + "</div>";
      html += "<div><strong>Date:</strong> " + formatDate(inv.date) + "</div>";
      html += "<div><strong>Customer:</strong> " + inv.customer + "</div>";
      html += "<hr/>";
      html += "<table>";
      html += "<tr><th>Item</th><th>Qty</th><th>Price</th><th>Total</th></tr>";

      let total = 0;

      inv.items.forEach(it => {
        const line = it.qty * it.price;
        total += line;

        html += `
          <tr>
            <td>${it.name}</td>
            <td>${it.qty}</td>
            <td>${it.price.toFixed(0)}</td>
            <td>${line.toFixed(0)}</td>
          </tr>
        `;
      });

      html += "</table>";
      html += "<h3>Total: " + total.toFixed(0) + " PKR</h3>";

      openPrintWindow(html, "Invoice A4");
    });
          /* -------------------------
       BACKUP / RESTORE
    --------------------------*/

    const setUser = document.getElementById("setUser");
    const setPass = document.getElementById("setPass");
    const btnSaveLogin = document.getElementById("btnSaveLogin");
    const btnExportData = document.getElementById("btnExportData");
    const btnClearAllData = document.getElementById("btnClearAllData");
    const btnImportData = document.getElementById("btnImportData");
    const backupJson = document.getElementById("backupJson");

    btnSaveLogin.addEventListener("click", () => {
      const u = setUser.value.trim();
      const p = setPass.value.trim();
      if (!u || !p) return alert("Username & password required");
      localStorage.setItem(KEY_LOGIN, JSON.stringify({ username: u, password: p }));
      alert("Login updated");
    });

    btnExportData.addEventListener("click", () => {
      const data = {
        products,
        invoices,
        expenses,
        login: JSON.parse(localStorage.getItem(KEY_LOGIN) || "null")
      };
      backupJson.value = JSON.stringify(data, null, 2);
      alert("Data exported below");
    });

    btnImportData.addEventListener("click", () => {
      if (!backupJson.value.trim()) return alert("Paste JSON first");
      try {
        const data = JSON.parse(backupJson.value);
        if (data.products) { products = data.products; saveProducts(); }
        if (data.invoices) { invoices = data.invoices; saveInvoices(); }
        if (data.expenses) { expenses = data.expenses; saveExpenses(); }
        if (data.login) localStorage.setItem(KEY_LOGIN, JSON.stringify(data.login));
        alert("Data imported");
        refreshAll();
      } catch {
        alert("Invalid JSON");
      }
    });

    btnClearAllData.addEventListener("click", () => {
      if (!confirm("Clear ALL data?")) return;
      localStorage.removeItem(KEY_PRODUCTS);
      localStorage.removeItem(KEY_INVOICES);
      localStorage.removeItem(KEY_EXPENSES);
      localStorage.removeItem(KEY_LOGIN);
      products = []; invoices = []; expenses = []; cart = [];
      loadData(); refreshAll();
      alert("All data cleared. Default login restored.");
    });

    /* -------------------------
       INIT APP
    --------------------------*/

    function refreshAll() {
      renderInventory();
      renderPosSearch();
      renderCart();
      renderExpenses();
      renderInvoices();
      refreshDashboard();
      const login = JSON.parse(localStorage.getItem(KEY_LOGIN) || "null");
      if (login) { setUser.value = login.username; setPass.value = login.password; }
    }

    loadData();
    updateHeaderDate();
    refreshAll();

    const savedLang = localStorage.getItem(KEY_LANG) || "EN";
    applyLanguage(savedLang);

    document.getElementById("btnLangEN").addEventListener("click", () => applyLanguage("EN"));
    document.getElementById("btnLangUR").addEventListener("click", () => applyLanguage("UR"));

  </script>
</body>
</html>








